*** Settings ***
Resource  plone/act/plone.txt

#Suite Setup  Start browser and wake Plone up  plone.app.toolbar.testing.TOOLBAR_ROBOTFRAMEWORK_TESTING
Suite Setup  Create plone.app.toolbar test site
Suite Teardown  Close browser and selenium server

*** Test cases ***

Anonymous should'nt see toolbar
    Log out
    Page Should Not Contain Element  id=plone-toolbar

Logged in should see toolbar
    Toolbar Log in  test-user  secret
    Page Should Contain Element  id=plone-toolbar


*** Keywords ***

Create plone.app.toolbar test site
    Start Zope Server  plone.app.toolbar.testing.TOOLBAR_ROBOTFRAMEWORK_TESTING
    Zodb setup
    Set Selenium timeout  15s
    Set Selenium implicit wait  1s
    
    ${previous}  Register keyword to run on failure  Close Browser
    Wait until keyword succeeds  2min  3s  Access plone
    Register keyword to run on failure  ${previous}

Toolbar Log in
    [Arguments]  ${userid}  ${password}
    Go to  ${PLONE_URL}/login_form
    Page should contain element  __ac_name
    Input text  __ac_name  ${userid}
    Input text  __ac_password  ${password}
    Click Button  Log in
    #Page should contain element  css=#user-name 
    Go to  ${PLONE_URL}
    [Return]  True
