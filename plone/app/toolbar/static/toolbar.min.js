var requirejs,require,define;(function(undef){var defined={},waiting={},config={},defining={},aps=[].slice,main,req;function normalize(name,baseName){var baseParts=baseName&&baseName.split("/"),map=config.map,starMap=map&&map["*"]||{},nameParts,nameSegment,mapValue,foundMap,i,j,part;if(name&&name.charAt(0)==="."){if(baseName){baseParts=baseParts.slice(0,baseParts.length-1);name=baseParts.concat(name.split("/"));for(i=0;part=name[i];i++){if(part==="."){name.splice(i,1);i-=1}else if(part===".."){if(i===1&&(name[2]===".."||name[0]==="..")){return true}else if(i>0){name.splice(i-1,2);i-=2}}}name=name.join("/")}}if((baseParts||starMap)&&map){nameParts=name.split("/");for(i=nameParts.length;i>0;i-=1){nameSegment=nameParts.slice(0,i).join("/");if(baseParts){for(j=baseParts.length;j>0;j-=1){mapValue=map[baseParts.slice(0,j).join("/")];if(mapValue){mapValue=mapValue[nameSegment];if(mapValue){foundMap=mapValue;break}}}}foundMap=foundMap||starMap[nameSegment];if(foundMap){nameParts.splice(0,i,foundMap);name=nameParts.join("/");break}}}return name}function makeRequire(relName,forceSync){return function(){return req.apply(undef,aps.call(arguments,0).concat([relName,forceSync]))}}function makeNormalize(relName){return function(name){return normalize(name,relName)}}function makeLoad(depName){return function(value){defined[depName]=value}}function callDep(name){if(waiting.hasOwnProperty(name)){var args=waiting[name];delete waiting[name];defining[name]=true;main.apply(undef,args)}if(!defined.hasOwnProperty(name)){throw new Error("No "+name)}return defined[name]}function makeMap(name,relName){var prefix,plugin,index=name.indexOf("!");if(index!==-1){prefix=normalize(name.slice(0,index),relName);name=name.slice(index+1);plugin=callDep(prefix);if(plugin&&plugin.normalize){name=plugin.normalize(name,makeNormalize(relName))}else{name=normalize(name,relName)}}else{name=normalize(name,relName)}return{f:prefix?prefix+"!"+name:name,n:name,p:plugin}}function makeConfig(name){return function(){return config&&config.config&&config.config[name]||{}}}main=function(name,deps,callback,relName){var args=[],usingExports,cjsModule,depName,ret,map,i;relName=relName||name;if(typeof callback==="function"){deps=!deps.length&&callback.length?["require","exports","module"]:deps;for(i=0;i<deps.length;i++){map=makeMap(deps[i],relName);depName=map.f;if(depName==="require"){args[i]=makeRequire(name)}else if(depName==="exports"){args[i]=defined[name]={};usingExports=true}else if(depName==="module"){cjsModule=args[i]={id:name,uri:"",exports:defined[name],config:makeConfig(name)}}else if(defined.hasOwnProperty(depName)||waiting.hasOwnProperty(depName)){args[i]=callDep(depName)}else if(map.p){map.p.load(map.n,makeRequire(relName,true),makeLoad(depName),{});args[i]=defined[depName]}else if(!defining[depName]){throw new Error(name+" missing "+depName)}}ret=callback.apply(defined[name],args);if(name){if(cjsModule&&cjsModule.exports!==undef&&cjsModule.exports!==defined[name]){defined[name]=cjsModule.exports}else if(ret!==undef||!usingExports){defined[name]=ret}}}else if(name){defined[name]=callback}};requirejs=require=req=function(deps,callback,relName,forceSync){if(typeof deps==="string"){return callDep(makeMap(deps,callback).f)}else if(!deps.splice){config=deps;if(callback.splice){deps=callback;callback=relName;relName=null}else{deps=undef}}callback=callback||function(){};if(forceSync){main(undef,deps,callback,relName)}else{setTimeout(function(){main(undef,deps,callback,relName)},15)}return req};req.config=function(cfg){config=cfg;return req};define=function(name,deps,callback){if(!deps.splice){callback=deps;deps=[]}waiting[name]=[name,deps,callback]};define.amd={jQuery:true}})();define("requireLib",function(){});define("js/jquery.iframe",["jquery"],function($,undefined){$.IFrame=function(iframe){this._init(iframe)};$.IFrame.prototype={_init:function(iframe){var self=this;self._iframe=iframe;self.$el=$(iframe.el);self.window=window.parent;self.document=window.parent.document;self.is_stretched=false;$(document).on("click",function(e){if($.nodeName(e.target,"a")||$(e.target).parents("a").size()===1){e.stopPropagation();e.preventDefault();var url=$(e.target).attr("href");if(!$.nodeName(e.target,"a")){url=$(e.target).parents("a").attr("href")}if(e.which===1){self._same_window(url)}else if(e.which===2){self._new_window(url)}}else if($.nodeName(e.target,"html")){self.shrink()}else{self.$el.trigger("click.iframe",e)}});self.fit();$(window).on("resize",function(e){self.fit()})},_same_window:function(url){this.window.location.href=url},_new_window:function(url){this.window.open(url)},shrink:function(){var self=this;if(self.is_stretched){self.$el.trigger("shrink.iframe");self.is_stretched=false;self.fit();self.$el.trigger("shrinked.iframe")}},stretch:function(){var self=this;if(!self.is_stretched){self.$el.trigger("stretch.iframe");self.is_stretched=true;self.$el.css({height:$(self.document).height()});self.$el.trigger("stretched.iframe")}},toggle:function(){var self=this;if(!self.is_stretched){self.stretch()}else{self.shrink()}},fit:function(){var self=this;if(!self.is_stretched){self.$el.css({height:$("body",document).height()});$("body",self.document).css("margin-top",$("body",document).height())}else{self.$el.css({height:$(self.document).height()})}}};if(window.parent.iframe!==undefined&&window.name&&window.parent.iframe[window.name]!==undefined){$.iframe=new $.IFrame(window.parent.iframe[window.name])}return $.iframe});(function(){if(!Function.prototype.bind){Function.prototype.bind=function(oThis){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply(this instanceof fNOP&&oThis?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)))};fNOP.prototype=this.prototype;fBound.prototype=new fNOP;return fBound}}var root,writer;var Level={DEBUG:10,INFO:20,WARN:30,ERROR:40,FATAL:50};function IEConsoleWriter(){}IEConsoleWriter.prototype={output:function(log_name,level,messages){if(console===undefined||console.log===undefined)return;if(log_name)messages.unshift(log_name+":");var message=messages.join(" ");if(console.info===undefined){var level_name;if(level<=Level.DEBUG)level_name="DEBUG";else if(level<=Level.INFO)level_name="INFO";else if(level<=Level.WARN)level_name="WARN";else if(level<=Level.ERROR)level_name="ERROR";else level_name="FATAL";console.log("["+level_name+"] "+message)}else{if(level<=Level.DEBUG){message="[DEBUG] "+message;console.log(message)}else if(level<=Level.INFO)console.info(message);else if(level<=Level.WARN)console.warn(message);else console.error(message)}}};function ConsoleWriter(){}ConsoleWriter.prototype={output:function(log_name,level,messages){if(log_name)messages.unshift(log_name+":");if(level<=Level.DEBUG){messages.unshift("[DEBUG]");console.log.apply(console,messages)}else if(level<=Level.INFO)console.info.apply(console,messages);else if(level<=Level.WARN)console.warn.apply(console,messages);else console.error.apply(console,messages)}};function Logger(name,parent){this._loggers={};this.name=name||"";this._parent=parent||null;if(!parent){this._enabled=true;this._level=Level.WARN}}Logger.prototype={getLogger:function(name){var path=name.split("."),root=this,route=this.name?[this.name]:[];while(path.length){var entry=path.shift();route.push(entry);if(!(entry in root._loggers))root._loggers[entry]=new Logger(route.join("."),root);root=root._loggers[entry]}return root},_getFlag:function(flag){var context=this;flag="_"+flag;while(context!==null){if(context[flag]!==undefined)return context[flag];context=context._parent}return null},setEnabled:function(state){this._enabled=!!state},isEnabled:function(){this._getFlag("enabled")},setLevel:function(level){if(typeof level==="number")this._level=level;else if(typeof level==="string"){level=level.toUpperCase();if(level in Level)this._level=Level[level]}},getLevel:function(){return this._getFlag("level")},log:function(level,messages){if(!messages.length||!this._getFlag("enabled")||level<this._getFlag("level"))return;messages=Array.prototype.slice.call(messages);writer.output(this.name,level,messages)},debug:function(){this.log(Level.DEBUG,arguments)},info:function(){this.log(Level.INFO,arguments)},warn:function(){this.log(Level.WARN,arguments)},error:function(){this.log(Level.ERROR,arguments)},fatal:function(){this.log(Level.FATAL,arguments)}};function getWriter(){return writer}function setWriter(w){writer=w}if(window.console&&window.console.log&&window.console.log.apply!==undefined)setWriter(new ConsoleWriter);else setWriter(new IEConsoleWriter);root=new Logger;var logconfig=/loglevel(|-[^=]+)=([^&]+)/g,match;while((match=logconfig.exec(window.location.search))!==null){var logger=match[1]===""?root:root.getLogger(match[1].slice(1));logger.setLevel(match[2].toUpperCase())}var api={Level:Level,getLogger:root.getLogger.bind(root),setEnabled:root.setEnabled.bind(root),isEnabled:root.isEnabled.bind(root),setLevel:root.setLevel.bind(root),getLevel:root.getLevel.bind(root),debug:root.debug.bind(root),info:root.info.bind(root),warn:root.warn.bind(root),error:root.error.bind(root),fatal:root.fatal.bind(root),getWriter:getWriter,setWriter:setWriter};if(typeof define==="function")define("logging/src/logging",[],function(){return api});else window.logging=api})();define("logging",["logging/src/logging"],function(main){return main});define("jam/Patterns/src/core/logger",["logging"],function(logging){var log=logging.getLogger("patterns");return log});define("jam/Patterns/src/utils",["jquery"],function($){var jquery_plugin=function(pattern){var plugin=function(method){var $this=this;if($this.length===0)return $this;if(!method||typeof method==="object"){pattern.init.apply($this,[$this].concat(Array.prototype.slice.call(arguments)))}else if(pattern[method]){return pattern[method].apply($this,[$this].concat(Array.prototype.slice.call(arguments,1)))}else{$.error("Method "+method+" does not exist on jQuery."+pattern.name)}return $this};return plugin};var debounce=function(func,wait){var timeout;return function(){var context=this,args=arguments;var later=function(){timeout=null;func.apply(context,args)};clearTimeout(timeout);timeout=setTimeout(later,wait)}};var rebaseURL=function(base,url){if(url.indexOf("://")!==-1||url[0]==="/")return url;return base.slice(0,base.lastIndexOf("/")+1)+url};var escapeRegExp=function(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")};var utils={jquery_plugin:jquery_plugin,debounce:debounce,escapeRegExp:escapeRegExp,rebaseURL:rebaseURL};return utils});define("jam/Patterns/src/compat",[],function(){if(!Array.prototype.every){Array.prototype.every=function(fun){if(this===null)throw new TypeError;var t=Object(this);var len=t.length>>>0;if(typeof fun!=="function")throw new TypeError;var thisp=arguments[1];for(var i=0;i<len;i++){if(i in t&&!fun.call(thisp,t[i],i,t))return false}return true}}if(!Array.prototype.filter){Array.prototype.filter=function(fun){if(this===null)throw new TypeError;var t=Object(this);var len=t.length>>>0;if(typeof fun!=="function")throw new TypeError;var res=[];var thisp=arguments[1];for(var i=0;i<len;i++){if(i in t){var val=t[i];if(fun.call(thisp,val,i,t))res.push(val)}}return res}}if(!Array.prototype.forEach){Array.prototype.forEach=function(callback,thisArg){var T,k;if(this===null){throw new TypeError(" this is null or not defined")}var O=Object(this);var len=O.length>>>0;if({}.toString.call(callback)!=="[object Function]"){throw new TypeError(callback+" is not a function")}if(thisArg){T=thisArg}k=0;while(k<len){var kValue;if(k in O){kValue=O[k];callback.call(T,kValue,k,O)}k++}}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(searchElement){if(this===null){throw new TypeError}var t=Object(this);var len=t.length>>>0;if(len===0){return-1}var n=0;if(arguments.length>0){n=Number(arguments[1]);if(n!==n){n=0}else if(n!==0&&n!==Infinity&&n!==-Infinity){n=(n>0||-1)*Math.floor(Math.abs(n))}}if(n>=len){return-1}var k=n>=0?n:Math.max(len-Math.abs(n),0);for(;k<len;k++){if(k in t&&t[k]===searchElement){return k}}return-1}}if(!Array.prototype.lastIndexOf){Array.prototype.lastIndexOf=function(searchElement){if(this===null)throw new TypeError;var t=Object(this);var len=t.length>>>0;if(len===0)return-1;var n=len;if(arguments.length>1){n=Number(arguments[1]);if(n!==n)n=0;else if(n!==0&&n!==1/0&&n!==-(1/0))n=(n>0||-1)*Math.floor(Math.abs(n))}var k=n>=0?Math.min(n,len-1):len-Math.abs(n);for(;k>=0;k--){if(k in t&&t[k]===searchElement)return k}return-1}}if(!Array.prototype.map){Array.prototype.map=function(callback,thisArg){var T,A,k;if(this===null){throw new TypeError(" this is null or not defined")}var O=Object(this);var len=O.length>>>0;if({}.toString.call(callback)!=="[object Function]"){throw new TypeError(callback+" is not a function")}if(thisArg){T=thisArg}A=new Array(len);k=0;while(k<len){var kValue,mappedValue;if(k in O){kValue=O[k];mappedValue=callback.call(T,kValue,k,O);A[k]=mappedValue}k++}return A}}if(!Array.prototype.reduce){Array.prototype.reduce=function reduce(accumulator){if(this===null||this===undefined)throw new TypeError("Object is null or undefined");var i=0,l=this.length>>0,curr;if(typeof accumulator!=="function")throw new TypeError("First argument is not callable");if(arguments.length<2){if(l===0)throw new TypeError("Array length is 0 and no second argument");curr=this[0];i=1}else curr=arguments[1];while(i<l){if(i in this)curr=accumulator.call(undefined,curr,this[i],i,this);++i}return curr}}if(!Array.prototype.reduceRight){Array.prototype.reduceRight=function(callbackfn){if(this===null)throw new TypeError;var t=Object(this);var len=t.length>>>0;if(typeof callbackfn!=="function")throw new TypeError;if(len===0&&arguments.length===1)throw new TypeError;var k=len-1;var accumulator;if(arguments.length>=2){accumulator=arguments[1]}else{do{if(k in this){accumulator=this[k--];break}if(--k<0)throw new TypeError}while(true)}while(k>=0){if(k in t)accumulator=callbackfn.call(undefined,accumulator,t[k],k,t);k--}return accumulator}}if(!Array.prototype.some){Array.prototype.some=function(fun){if(this===null)throw new TypeError;var t=Object(this);var len=t.length>>>0;if(typeof fun!=="function")throw new TypeError;var thisp=arguments[1];for(var i=0;i<len;i++){if(i in t&&fun.call(thisp,t[i],i,t))return true}return false}}if(!Array.isArray){Array.isArray=function(arg){return Object.prototype.toString.call(arg)==="[object Array]"}}if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}if(!Function.prototype.bind){Function.prototype.bind=function(oThis){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply(this instanceof fNOP&&oThis?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)))};fNOP.prototype=this.prototype;fBound.prototype=new fNOP;return fBound}}if(!Object.keys){Object.keys=function(){var _hasOwnProperty=Object.prototype.hasOwnProperty,hasDontEnumBug=!{toString:null}.propertyIsEnumerable("toString"),dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],dontEnumsLength=dontEnums.length;return function(obj){if(typeof obj!=="object"&&typeof obj!=="function"||obj===null)throw new TypeError("Object.keys called on non-object");var result=[];for(var prop in obj)if(_hasOwnProperty.call(obj,prop))result.push(prop);if(hasDontEnumBug)for(var i=0;i<dontEnumsLength;i++)if(_hasOwnProperty.call(obj,dontEnums[i]))result.push(dontEnums[i]);return result}}()}});define("jam/Patterns/src/registry",["jquery","./core/logger","./utils","./compat"],function($,logger,utils){var log=logger.getLogger("registry"),jquery_plugin=utils.jquery_plugin;var registry={patterns:{},init:function(){$(document).ready(function(){log.info("loaded: "+Object.keys(registry.patterns).sort().join(", "));registry.scan(document.body);log.info("finished initial scan.")})},scan:function(content,do_not_catch_init_exception){var $content=$(content),all=[],allsel,pattern,$match,plog,name;for(name in registry.patterns){pattern=registry.patterns[name];if(pattern.transform)try{pattern.transform($content)}catch(e){log.critical("Transform error for pattern"+name,e)}if(pattern.trigger)all.push(pattern.trigger)}allsel=all.join(",");$match=$content.find(allsel);if($content.is(allsel))$match=$match.add($content);$match=$match.filter(function(){return $(this).parents("pre").length===0});$match=$match.filter(":not(.cant-touch-this)");$match.toArray().reduceRight(function(acc,el){var $el=$(el);for(var name in registry.patterns){pattern=registry.patterns[name];plog=logger.getLogger("pat."+name);if($el.is(pattern.trigger)){plog.debug("Initialising:",$el);try{pattern.init($el);plog.debug("done.")}catch(e){if(do_not_catch_init_exception){throw e}else{plog.error("Caught error:",e)}}}}},null)},register:function(pattern){if(!pattern.name){log.error("Pattern lacks name:",pattern);return false}if(registry.patterns[pattern.name]){log.error("Already have a pattern called: "+pattern.name);return false}registry.patterns[pattern.name]=pattern;if(pattern.jquery_plugin){var pluginName=("pat-"+pattern.name).replace(/-([a-zA-Z])/g,function(match,p1){return p1.toUpperCase()});$.fn[pluginName]=jquery_plugin(pattern);$.fn[pluginName.replace(/^pat/,"pattern")]=jquery_plugin(pattern)}log.debug("Registered pattern:",pattern.name,pattern);return true}};$(document).on("patterns-injected.patterns",function(ev){registry.scan(ev.target);$(ev.target).trigger("patterns-injected-scanned")});return registry});define("js/patterns/base",["jquery","jam/Patterns/src/registry","jam/Patterns/src/core/logger"],function($,registry,logger,undefined){function getOptions($el,prefix,options){options=options||{};if($el.size()!==0&&!$.nodeName($el[0],"body")){options=getOptions($el.parent(),prefix,options)}if($el.length){$.each($el[0].attributes,function(index,attr){if(attr.name.substr(0,("data-"+prefix).length)==="data-"+prefix){var name=attr.name.substr(("data-"+prefix).length+1),value=attr.value.replace(/^\s+|\s+$/g,"");if(value.substring(0,1)==="{"||value.substring(0,1)==="["){value=JSON.parse(value)}else if(value==="true"){value=true}else if(value==="false"){value=false}if(name===""){options=value}else{var names=name.split("-"),names_options=options;$.each(names,function(i,name){if(names.length>i+1){if(!names_options[name]){names_options[name]={}}names_options=names_options[name]}else{names_options[name]=value}})}}})}return options}var Base=function($el,options){this.log=logger.getLogger(this.name);this.$el=$el;if(this.parser){this.options=$.extend(true,{},this.parser.parse($el,this.defaults||{},this.multipleOptions||false),options||{})}else{this.options=$.extend(true,{},this.defaults||{},getOptions($el,this.name),options||{})}this.init();this.trigger("init")};Base.prototype={constructor:Base,on:function(eventName,eventCallback){this.$el.on(eventName+"."+this.name+".patterns",eventCallback)},trigger:function(eventName){this.$el.trigger(eventName+"."+this.name+".patterns",[this])}};Base.extend=function(NewPattern){var Base=this,jquery_plugin=true;var Constructor;if(NewPattern&&NewPattern.hasOwnProperty("constructor")){Constructor=NewPattern.constructor}else{Constructor=function(){Base.apply(this,arguments)}}var Surrogate=function(){this.constructor=Constructor};Surrogate.prototype=Base.prototype;Constructor.prototype=new Surrogate;$.extend(true,Constructor.prototype,NewPattern);Constructor.__super__=Base.prototype;if(Constructor.prototype.jqueryPlugin){jquery_plugin=false;$.fn[Constructor.prototype.jqueryPlugin]=function(method,options){$(this).each(function(){var $el=$(this),pattern=$el.data("pattern-"+Constructor.prototype.name);if(typeof method==="object"){options=method;method=undefined}if(!pattern||typeof pattern==="string"){pattern=new Constructor($el,options);$el.data("pattern-"+Constructor.prototype.name,pattern)}else if(method&&pattern&&pattern[method]){pattern[method].apply(pattern,[options])}});return this}}registry.register({name:Constructor.prototype.name,trigger:".pat-"+Constructor.prototype.name,jquery_plugin:jquery_plugin,init:function($all){return $all.each(function(i){var $el=$(this),data=$el.data("pattern-"+Constructor.prototype.name+"-"+i);if(!data){$el.data("pattern-"+Constructor.prototype.name+"-"+i,new Constructor($el))}})}});return Constructor};return Base});define("js/patterns/backdrop",["jquery","js/patterns/base"],function($,Base,Parser){var Backdrop=Base.extend({name:"backdrop",defaults:{zIndex:"1000",opacity:"0.8",klass:"backdrop",klassActive:"backdrop-active",closeOnEsc:true,closeOnClick:true},init:function(){var self=this;self.$backdrop=$("> ."+self.options.klass,self.$el);if(self.$backdrop.size()===0){self.$backdrop=$("<div/>").hide().appendTo(self.$el).addClass(self.options.klass)}if(self.options.closeOnEsc===true){$(document).on("keydown",function(e,data){if(self.$el.is("."+self.options.klassActive)){if(e.keyCode===27){self.hide()}}})}if(self.options.closeOnClick===true){self.$backdrop.on("click",function(){if(self.$el.is("."+self.options.klassActive)){self.hide()}})}},show:function(){var self=this;if(!self.$el.hasClass(self.options.klassActive)){self.trigger("show");self.$backdrop.css("opacity","0").show();self.$el.addClass(self.options.klassActive);self.$backdrop.animate({opacity:self.options.opacity},500);self.trigger("shown")}},hide:function(){var self=this;if(self.$el.hasClass(self.options.klassActive)){self.trigger("hide");self.$backdrop.animate({opacity:"0"},500).hide();self.$el.removeClass(self.options.klassActive);self.trigger("hidden")}}});return Backdrop});(function($){var feature={};feature.fileapi=$("<input type='file'/>").get(0).files!==undefined;feature.formdata=window.FormData!==undefined;$.fn.ajaxSubmit=function(options){if(!this.length){log("ajaxSubmit: skipping submit process - no element selected");return this}var method,action,url,$form=this;if(typeof options=="function"){options={success:options}}method=this.attr("method");action=this.attr("action");url=typeof action==="string"?$.trim(action):"";url=url||window.location.href||"";if(url){url=(url.match(/^([^#]+)/)||[])[1]}options=$.extend(true,{url:url,success:$.ajaxSettings.success,type:method||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},options);var veto={};this.trigger("form-pre-serialize",[this,options,veto]);if(veto.veto){log("ajaxSubmit: submit vetoed via form-pre-serialize trigger");return this}if(options.beforeSerialize&&options.beforeSerialize(this,options)===false){log("ajaxSubmit: submit aborted via beforeSerialize callback");return this}var traditional=options.traditional;if(traditional===undefined){traditional=$.ajaxSettings.traditional}var elements=[];var qx,a=this.formToArray(options.semantic,elements);if(options.data){options.extraData=options.data;qx=$.param(options.data,traditional)}if(options.beforeSubmit&&options.beforeSubmit(a,this,options)===false){log("ajaxSubmit: submit aborted via beforeSubmit callback");return this}this.trigger("form-submit-validate",[a,this,options,veto]);if(veto.veto){log("ajaxSubmit: submit vetoed via form-submit-validate trigger");return this}var q=$.param(a,traditional);if(qx){q=q?q+"&"+qx:qx}if(options.type.toUpperCase()=="GET"){options.url+=(options.url.indexOf("?")>=0?"&":"?")+q;options.data=null}else{options.data=q}var callbacks=[];if(options.resetForm){callbacks.push(function(){$form.resetForm()})}if(options.clearForm){callbacks.push(function(){$form.clearForm(options.includeHidden)})}if(!options.dataType&&options.target){var oldSuccess=options.success||function(){};callbacks.push(function(data){var fn=options.replaceTarget?"replaceWith":"html";$(options.target)[fn](data).each(oldSuccess,arguments)})}else if(options.success){callbacks.push(options.success)}options.success=function(data,status,xhr){var context=options.context||this;for(var i=0,max=callbacks.length;i<max;i++){callbacks[i].apply(context,[data,status,xhr||$form,$form])}};var fileInputs=$('input[type=file]:enabled[value!=""]',this);var hasFileInputs=fileInputs.length>0;var mp="multipart/form-data";var multipart=$form.attr("enctype")==mp||$form.attr("encoding")==mp;var fileAPI=feature.fileapi&&feature.formdata;log("fileAPI :"+fileAPI);var shouldUseFrame=(hasFileInputs||multipart)&&!fileAPI;var jqxhr;if(options.iframe!==false&&(options.iframe||shouldUseFrame)){if(options.closeKeepAlive){$.get(options.closeKeepAlive,function(){jqxhr=fileUploadIframe(a)})}else{jqxhr=fileUploadIframe(a)}}else if((hasFileInputs||multipart)&&fileAPI){jqxhr=fileUploadXhr(a)}else{jqxhr=$.ajax(options)}$form.removeData("jqxhr").data("jqxhr",jqxhr);for(var k=0;k<elements.length;k++)elements[k]=null;this.trigger("form-submit-notify",[this,options]);return this;function deepSerialize(extraData){var serialized=$.param(extraData).split("&");var len=serialized.length;var result={};var i,part;for(i=0;i<len;i++){serialized[i]=serialized[i].replace(/\+/g," ");part=serialized[i].split("=");result[decodeURIComponent(part[0])]=decodeURIComponent(part[1])}return result}function fileUploadXhr(a){var formdata=new FormData;for(var i=0;i<a.length;i++){formdata.append(a[i].name,a[i].value)}if(options.extraData){var serializedData=deepSerialize(options.extraData);for(var p in serializedData)if(serializedData.hasOwnProperty(p))formdata.append(p,serializedData[p])}options.data=null;var s=$.extend(true,{},$.ajaxSettings,options,{contentType:false,processData:false,cache:false,type:method||"POST"});if(options.uploadProgress){s.xhr=function(){var xhr=jQuery.ajaxSettings.xhr();if(xhr.upload){xhr.upload.onprogress=function(event){var percent=0;var position=event.loaded||event.position;var total=event.total;if(event.lengthComputable){percent=Math.ceil(position/total*100)}options.uploadProgress(event,position,total,percent)}}return xhr}}s.data=null;var beforeSend=s.beforeSend;s.beforeSend=function(xhr,o){o.data=formdata;if(beforeSend)beforeSend.call(this,xhr,o)};return $.ajax(s)}function fileUploadIframe(a){var form=$form[0],el,i,s,g,id,$io,io,xhr,sub,n,timedOut,timeoutHandle;var useProp=!!$.fn.prop;var deferred=$.Deferred();if($("[name=submit],[id=submit]",form).length){alert('Error: Form elements must not have name or id of "submit".');deferred.reject();return deferred}if(a){for(i=0;i<elements.length;i++){el=$(elements[i]);if(useProp)el.prop("disabled",false);else el.removeAttr("disabled")}}s=$.extend(true,{},$.ajaxSettings,options);s.context=s.context||s;id="jqFormIO"+(new Date).getTime();if(s.iframeTarget){$io=$(s.iframeTarget);n=$io.attr("name");if(!n)$io.attr("name",id);else id=n}else{$io=$('<iframe name="'+id+'" src="'+s.iframeSrc+'" />');$io.css({position:"absolute",top:"-1000px",left:"-1000px"})}io=$io[0];xhr={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(status){var e=status==="timeout"?"timeout":"aborted";log("aborting upload... "+e);this.aborted=1;try{if(io.contentWindow.document.execCommand){io.contentWindow.document.execCommand("Stop")}}catch(ignore){}$io.attr("src",s.iframeSrc);xhr.error=e;if(s.error)s.error.call(s.context,xhr,e,status);if(g)$.event.trigger("ajaxError",[xhr,s,e]);if(s.complete)s.complete.call(s.context,xhr,e)}};g=s.global;if(g&&0===$.active++){$.event.trigger("ajaxStart")}if(g){$.event.trigger("ajaxSend",[xhr,s])}if(s.beforeSend&&s.beforeSend.call(s.context,xhr,s)===false){if(s.global){$.active--}deferred.reject();return deferred}if(xhr.aborted){deferred.reject();return deferred}sub=form.clk;if(sub){n=sub.name;if(n&&!sub.disabled){s.extraData=s.extraData||{};s.extraData[n]=sub.value;if(sub.type=="image"){s.extraData[n+".x"]=form.clk_x;s.extraData[n+".y"]=form.clk_y}}}var CLIENT_TIMEOUT_ABORT=1;var SERVER_ABORT=2;function getDoc(frame){var doc=frame.contentWindow?frame.contentWindow.document:frame.contentDocument?frame.contentDocument:frame.document;return doc}var csrf_token=$("meta[name=csrf-token]").attr("content");var csrf_param=$("meta[name=csrf-param]").attr("content");if(csrf_param&&csrf_token){s.extraData=s.extraData||{};s.extraData[csrf_param]=csrf_token}function doSubmit(){var t=$form.attr("target"),a=$form.attr("action");form.setAttribute("target",id);if(!method){form.setAttribute("method","POST")}if(a!=s.url){form.setAttribute("action",s.url)}if(!s.skipEncodingOverride&&(!method||/post/i.test(method))){$form.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"})}if(s.timeout){timeoutHandle=setTimeout(function(){timedOut=true;cb(CLIENT_TIMEOUT_ABORT)},s.timeout)}function checkState(){try{var state=getDoc(io).readyState;log("state = "+state);if(state&&state.toLowerCase()=="uninitialized")setTimeout(checkState,50)}catch(e){log("Server abort: ",e," (",e.name,")");cb(SERVER_ABORT);if(timeoutHandle)clearTimeout(timeoutHandle);timeoutHandle=undefined}}var extraInputs=[];try{if(s.extraData){for(var n in s.extraData){if(s.extraData.hasOwnProperty(n)){if($.isPlainObject(s.extraData[n])&&s.extraData[n].hasOwnProperty("name")&&s.extraData[n].hasOwnProperty("value")){extraInputs.push($('<input type="hidden" name="'+s.extraData[n].name+'">').val(s.extraData[n].value).appendTo(form)[0])}else{extraInputs.push($('<input type="hidden" name="'+n+'">').val(s.extraData[n]).appendTo(form)[0])}}}}if(!s.iframeTarget){$io.appendTo("body");if(io.attachEvent)io.attachEvent("onload",cb);else io.addEventListener("load",cb,false)}setTimeout(checkState,15);form.submit()}finally{form.setAttribute("action",a);if(t){form.setAttribute("target",t)}else{$form.removeAttr("target")}$(extraInputs).remove()}}if(s.forceSync){doSubmit()}else{setTimeout(doSubmit,10)}var data,doc,domCheckCount=50,callbackProcessed;function cb(e){if(xhr.aborted||callbackProcessed){return}try{doc=getDoc(io)}catch(ex){log("cannot access response document: ",ex);e=SERVER_ABORT}if(e===CLIENT_TIMEOUT_ABORT&&xhr){xhr.abort("timeout");deferred.reject(xhr,"timeout");return}else if(e==SERVER_ABORT&&xhr){xhr.abort("server abort");deferred.reject(xhr,"error","server abort");return}if(!doc||doc.location.href==s.iframeSrc){if(!timedOut)return}if(io.detachEvent)io.detachEvent("onload",cb);else io.removeEventListener("load",cb,false);var status="success",errMsg;try{if(timedOut){throw"timeout"}var isXml=s.dataType=="xml"||doc.XMLDocument||$.isXMLDoc(doc);log("isXml="+isXml);if(!isXml&&window.opera&&(doc.body===null||!doc.body.innerHTML)){if(--domCheckCount){log("requeing onLoad callback, DOM not available");setTimeout(cb,250);return}}var docRoot=doc.body?doc.body:doc.documentElement;xhr.responseText=docRoot?docRoot.innerHTML:null;xhr.responseXML=doc.XMLDocument?doc.XMLDocument:doc;if(isXml)s.dataType="xml";xhr.getResponseHeader=function(header){var headers={"content-type":s.dataType};return headers[header]};if(docRoot){xhr.status=Number(docRoot.getAttribute("status"))||xhr.status;xhr.statusText=docRoot.getAttribute("statusText")||xhr.statusText}var dt=(s.dataType||"").toLowerCase();var scr=/(json|script|text)/.test(dt);if(scr||s.textarea){var ta=doc.getElementsByTagName("textarea")[0];if(ta){xhr.responseText=ta.value;xhr.status=Number(ta.getAttribute("status"))||xhr.status;xhr.statusText=ta.getAttribute("statusText")||xhr.statusText}else if(scr){var pre=doc.getElementsByTagName("pre")[0];var b=doc.getElementsByTagName("body")[0];if(pre){xhr.responseText=pre.textContent?pre.textContent:pre.innerText}else if(b){xhr.responseText=b.textContent?b.textContent:b.innerText}}}else if(dt=="xml"&&!xhr.responseXML&&xhr.responseText){xhr.responseXML=toXml(xhr.responseText)}try{data=httpData(xhr,dt,s)}catch(e){status="parsererror";xhr.error=errMsg=e||status}}catch(e){log("error caught: ",e);status="error";xhr.error=errMsg=e||status
}if(xhr.aborted){log("upload aborted");status=null}if(xhr.status){status=xhr.status>=200&&xhr.status<300||xhr.status===304?"success":"error"}if(status==="success"){if(s.success)s.success.call(s.context,data,"success",xhr);deferred.resolve(xhr.responseText,"success",xhr);if(g)$.event.trigger("ajaxSuccess",[xhr,s])}else if(status){if(errMsg===undefined)errMsg=xhr.statusText;if(s.error)s.error.call(s.context,xhr,status,errMsg);deferred.reject(xhr,"error",errMsg);if(g)$.event.trigger("ajaxError",[xhr,s,errMsg])}if(g)$.event.trigger("ajaxComplete",[xhr,s]);if(g&&!--$.active){$.event.trigger("ajaxStop")}if(s.complete)s.complete.call(s.context,xhr,status);callbackProcessed=true;if(s.timeout)clearTimeout(timeoutHandle);setTimeout(function(){if(!s.iframeTarget)$io.remove();xhr.responseXML=null},100)}var toXml=$.parseXML||function(s,doc){if(window.ActiveXObject){doc=new ActiveXObject("Microsoft.XMLDOM");doc.async="false";doc.loadXML(s)}else{doc=(new DOMParser).parseFromString(s,"text/xml")}return doc&&doc.documentElement&&doc.documentElement.nodeName!="parsererror"?doc:null};var parseJSON=$.parseJSON||function(s){return window["eval"]("("+s+")")};var httpData=function(xhr,type,s){var ct=xhr.getResponseHeader("content-type")||"",xml=type==="xml"||!type&&ct.indexOf("xml")>=0,data=xml?xhr.responseXML:xhr.responseText;if(xml&&data.documentElement.nodeName==="parsererror"){if($.error)$.error("parsererror")}if(s&&s.dataFilter){data=s.dataFilter(data,type)}if(typeof data==="string"){if(type==="json"||!type&&ct.indexOf("json")>=0){data=parseJSON(data)}else if(type==="script"||!type&&ct.indexOf("javascript")>=0){$.globalEval(data)}}return data};return deferred}};$.fn.ajaxForm=function(options){options=options||{};options.delegation=options.delegation&&$.isFunction($.fn.on);if(!options.delegation&&this.length===0){var o={s:this.selector,c:this.context};if(!$.isReady&&o.s){log("DOM not ready, queuing ajaxForm");$(function(){$(o.s,o.c).ajaxForm(options)});return this}log("terminating; zero elements found by selector"+($.isReady?"":" (DOM not ready)"));return this}if(options.delegation){$(document).off("submit.form-plugin",this.selector,doAjaxSubmit).off("click.form-plugin",this.selector,captureSubmittingElement).on("submit.form-plugin",this.selector,options,doAjaxSubmit).on("click.form-plugin",this.selector,options,captureSubmittingElement);return this}return this.ajaxFormUnbind().bind("submit.form-plugin",options,doAjaxSubmit).bind("click.form-plugin",options,captureSubmittingElement)};function doAjaxSubmit(e){var options=e.data;if(!e.isDefaultPrevented()){e.preventDefault();$(this).ajaxSubmit(options)}}function captureSubmittingElement(e){var target=e.target;var $el=$(target);if(!$el.is("[type=submit],[type=image]")){var t=$el.closest("[type=submit]");if(t.length===0){return}target=t[0]}var form=this;form.clk=target;if(target.type=="image"){if(e.offsetX!==undefined){form.clk_x=e.offsetX;form.clk_y=e.offsetY}else if(typeof $.fn.offset=="function"){var offset=$el.offset();form.clk_x=e.pageX-offset.left;form.clk_y=e.pageY-offset.top}else{form.clk_x=e.pageX-target.offsetLeft;form.clk_y=e.pageY-target.offsetTop}}setTimeout(function(){form.clk=form.clk_x=form.clk_y=null},100)}$.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")};$.fn.formToArray=function(semantic,elements){var a=[];if(this.length===0){return a}var form=this[0];var els=semantic?form.getElementsByTagName("*"):form.elements;if(!els){return a}var i,j,n,v,el,max,jmax;for(i=0,max=els.length;i<max;i++){el=els[i];n=el.name;if(!n){continue}if(semantic&&form.clk&&el.type=="image"){if(!el.disabled&&form.clk==el){a.push({name:n,value:$(el).val(),type:el.type});a.push({name:n+".x",value:form.clk_x},{name:n+".y",value:form.clk_y})}continue}v=$.fieldValue(el,true);if(v&&v.constructor==Array){if(elements)elements.push(el);for(j=0,jmax=v.length;j<jmax;j++){a.push({name:n,value:v[j]})}}else if(feature.fileapi&&el.type=="file"&&!el.disabled){if(elements)elements.push(el);var files=el.files;if(files.length){for(j=0;j<files.length;j++){a.push({name:n,value:files[j],type:el.type})}}else{a.push({name:n,value:"",type:el.type})}}else if(v!==null&&typeof v!="undefined"){if(elements)elements.push(el);a.push({name:n,value:v,type:el.type,required:el.required})}}if(!semantic&&form.clk){var $input=$(form.clk),input=$input[0];n=input.name;if(n&&!input.disabled&&input.type=="image"){a.push({name:n,value:$input.val()});a.push({name:n+".x",value:form.clk_x},{name:n+".y",value:form.clk_y})}}return a};$.fn.formSerialize=function(semantic){return $.param(this.formToArray(semantic))};$.fn.fieldSerialize=function(successful){var a=[];this.each(function(){var n=this.name;if(!n){return}var v=$.fieldValue(this,successful);if(v&&v.constructor==Array){for(var i=0,max=v.length;i<max;i++){a.push({name:n,value:v[i]})}}else if(v!==null&&typeof v!="undefined"){a.push({name:this.name,value:v})}});return $.param(a)};$.fn.fieldValue=function(successful){for(var val=[],i=0,max=this.length;i<max;i++){var el=this[i];var v=$.fieldValue(el,successful);if(v===null||typeof v=="undefined"||v.constructor==Array&&!v.length){continue}if(v.constructor==Array)$.merge(val,v);else val.push(v)}return val};$.fieldValue=function(el,successful){var n=el.name,t=el.type,tag=el.tagName.toLowerCase();if(successful===undefined){successful=true}if(successful&&(!n||el.disabled||t=="reset"||t=="button"||(t=="checkbox"||t=="radio")&&!el.checked||(t=="submit"||t=="image")&&el.form&&el.form.clk!=el||tag=="select"&&el.selectedIndex==-1)){return null}if(tag=="select"){var index=el.selectedIndex;if(index<0){return null}var a=[],ops=el.options;var one=t=="select-one";var max=one?index+1:ops.length;for(var i=one?index:0;i<max;i++){var op=ops[i];if(op.selected){var v=op.value;if(!v){v=op.attributes&&op.attributes["value"]&&!op.attributes["value"].specified?op.text:op.value}if(one){return v}a.push(v)}}return a}return $(el).val()};$.fn.clearForm=function(includeHidden){return this.each(function(){$("input,select,textarea",this).clearFields(includeHidden)})};$.fn.clearFields=$.fn.clearInputs=function(includeHidden){var re=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var t=this.type,tag=this.tagName.toLowerCase();if(re.test(t)||tag=="textarea"){this.value=""}else if(t=="checkbox"||t=="radio"){this.checked=false}else if(tag=="select"){this.selectedIndex=-1}else if(t=="file"){if(/MSIE/.test(navigator.userAgent)){$(this).replaceWith($(this).clone())}else{$(this).val("")}}else if(includeHidden){if(includeHidden===true&&/hidden/.test(t)||typeof includeHidden=="string"&&$(this).is(includeHidden))this.value=""}})};$.fn.resetForm=function(){return this.each(function(){if(typeof this.reset=="function"||typeof this.reset=="object"&&!this.reset.nodeType){this.reset()}})};$.fn.enable=function(b){if(b===undefined){b=true}return this.each(function(){this.disabled=!b})};$.fn.selected=function(select){if(select===undefined){select=true}return this.each(function(){var t=this.type;if(t=="checkbox"||t=="radio"){this.checked=select}else if(this.tagName.toLowerCase()=="option"){var $sel=$(this).parent("select");if(select&&$sel[0]&&$sel[0].type=="select-one"){$sel.find("option").selected(false)}this.selected=select}})};$.fn.ajaxSubmit.debug=false;function log(){if(!$.fn.ajaxSubmit.debug)return;var msg="[jquery.form] "+Array.prototype.join.call(arguments,"");if(window.console&&window.console.log){window.console.log(msg)}else if(window.opera&&window.opera.postError){window.opera.postError(msg)}}})(jQuery);define("jam/jquery-form/jquery.form.js",function(){});define("js/patterns/toggle",["jquery","js/patterns/base"],function($,Base,undefined){var Toggle=Base.extend({name:"toggle",jqueryPlugin:"toggle",defaults:{attribute:"class",event:"click"},init:function(){var self=this;if(!self.options.target){self.$target=self.$el}else{self.$target=self.$el.closest(self.options.target);if(self.$target.size()===0){self.$target=self.closest(self.$el,self.options.target)}}if(!self.$target){$.error('No target found for "'+self.options.target+'".')}self.on(self.options.event,function(e){e.stopPropagation();if($(e.target).is("a")||$(e.target).parents("a").size()!==0){e.preventDefault()}self.toggle()})},closest:function($el,selector){var self=this,$target=$(selector,$el);if($target.size()===0){if($el.size()===0||$.nodeName($el[0],"body")){return}$target=self.closest($el.parent(),selector)}return $target},isMarked:function(){var self=this;if(self.options.attribute==="class"){return this.$target.hasClass(this.options.value)}else{return this.$target.attr(this.options.attribute)===this.options.value}},toggle:function(){var self=this;if(self.isMarked()){self.remove()}else{self.add()}},remove:function(){var self=this;self.trigger("remove-attr");if(self.options.attribute==="class"){self.$target.removeClass(self.options.value)}else{self.$target.removeAttr(self.options.attribute)}self.trigger("attr-removed")},add:function(){var self=this;self.trigger("add-attr");if(self.options.attribute==="class"){self.$target.addClass(self.options.value)}else{self.$target.attr(self.options.attribute,self.options.value)}self.trigger("added-attr")}});return Toggle});define("js/patterns/modal.js",["jquery","js/patterns/base","js/patterns/backdrop","jam/Patterns/src/registry"],function($,Base,Backdrop,registry,undefined){var Modal=Base.extend({name:"modal",jqueryPlugin:"modal",defaults:{triggers:"",position:"center middle",width:"",height:"",margin:"20px",klass:"modal",klassWrapper:"modal-wrapper",klassWrapperInner:"modal-wrapper-inner",klassLoading:"modal-loading",klassActive:"active",backdrop:"body",backdropZIndex:"1000",backdropOpacity:"0.8",backdropKlass:"backdrop",backdropKlassActive:"backdrop-active",backdropCloseOnEsc:true,backdropCloseOnClick:true},init:function(){var self=this;self.backdrop=new Backdrop(self.$el.parents(self.options.backdrop),{zindex:self.options.backdropZIndex,klass:self.options.backdropKlass,klassActive:self.options.backdropKlassActive,styles:self.options.backdropStyles,opacity:self.options.backdropOpacity,closeOnEsc:self.options.backdropCloseOnEsc,closeOnClick:self.options.backdropCloseOnClick});self.backdrop.on("hidden",function(e){self.hide()});self.$wrapper=$("> ."+self.options.klassWrapper,self.backdrop.$el);if(self.$wrapper.size()===0){self.$wrapper=$("<div/>").hide().css({"z-index":parseInt(self.options.backdropZIndex,10)+1,"overflow-y":"auto",position:"fixed",height:"100%",width:"100%",bottom:"0",left:"0",right:"0",top:"0"}).addClass(self.options.klassWrapper).insertBefore(self.backdrop.$backdrop).on("click",function(e){e.stopPropagation();e.preventDefault();self.backdrop.hide()})}self.$wrapperInner=$("> ."+self.options.klassWrapperInner,self.$wrapper);if(self.$wrapperInner.size()===0){self.$wrapperInner=$("<div/>").addClass(self.options.klassWrapperInner).css({position:"absolute",bottom:"0",left:"0",right:"0",top:"0"}).appendTo(self.$wrapper)}self.$loading=$("> ."+self.options.klassLoading,self.$wrapperInner);if(self.$loading.size()===0){self.$loading=$("<div/>").hide().addClass(self.options.klassLoading).appendTo(self.$wrapperInner)}$(window.parent).resize(function(){self.positionModal()});if(self.options.triggers){$.each(self.options.triggers,function(i,item){item=item.split(" ");$(item[1]||self.$el).on(item[0],function(){self.show()})})}if(self.$el.is("a")){if(self.$el.attr("href")){if(!self.options.target&&self.$el.attr("href").substr(0,1)==="#"){self.options.target=self.$el.attr("href")}if(!self.options.ajaxUrl&&self.$el.attr("href").substr(0,1)!=="#"){self.options.ajaxUrl=self.$el.attr("href")}}self.$el.on("click",function(e){e.stopPropagation();e.preventDefault();self.show()})}self.initModal();self.$wrapper.on("hidden",function(e){e.stopPropagation();e.preventDefault();self.hide()})},initModalElement:function($modal){var self=this;$modal.addClass(self.options.klass).on("click",function(e){e.stopPropagation();if($.nodeName(e.target,"a")){e.preventDefault()}}).on("destroy.modal.patterns",function(e){e.stopPropagation();self.hide()}).on("resize.modal.patterns",function(e){e.stopPropagation();e.preventDefault();self.positionModal(true)});return $modal},initModal:function(){var self=this;if(self.options.ajaxUrl){self.$modal=function(){self.trigger("before-ajax");self.$wrapper.parent().css("overflow","hidden");self.$wrapper.show();self.backdrop.show();self.$loading.show();self.positionLoading();self.ajaxXHR=$.ajax({url:self.options.ajaxUrl,type:self.options.ajaxType}).done(function(response,textStatus,xhr){self.ajaxXHR=undefined;self.$loading.hide();self.$modal=self.initModalElement($($(/<body[^>]*>((.|[\n\r])*)<\/body>/im.exec(response)[0].replace("<body","<div").replace("</body>","</div>"))[0])).appendTo(self.$wrapperInner);self.trigger("after-ajax",self,textStatus,xhr);self.show()})}}else if(self.options.target){self.$modal=function(){self.$modal=self.initModalElement($("<div/>")).html($(self.options.target).clone()).appendTo(self.$wrapperInner);self.show()}}else{self.$modal=self.initModalElement($("<div/>")).html(self.$el.clone()).appendTo(self.$wrapperInner)}},positionLoading:function(){var self=this;self.$loading.css({"margin-left":self.$wrapper.width()/2-self.$loading.width()/2,"margin-top":self.$wrapper.height()/2-self.$loading.height()/2,position:"absolute",bottom:"0",left:"0",right:"0",top:"0"})},positionModal:function(preserve_top){var self=this;if(typeof self.$modal!=="function"){if(preserve_top){preserve_top=self.$modal.css("top")}self.$modal.removeAttr("style");self.$wrapperInner.css({height:"",width:self.options.width});if(self.$wrapper.parent().is("body")){self.$wrapper.height($(window.parent).height())}self.$modal.css({padding:"0",margin:"0",width:self.options.width,height:self.options.height,position:"absolute",top:preserve_top?preserve_top:"0",left:"0"});self.$modal.css({margin:"0"});var modalOffsetBefore=self.$modal.offset();self.$modal.css({margin:self.options.margin});var modalOffset=self.$modal.offset(),modalOuterWidth=self.$modal.outerWidth(true),modalInnerWidth=self.$modal.innerWidth(),modalOuterHeight=self.$modal.outerHeight(true),modalInnerHeight=self.$modal.innerHeight();self.$modal.css({margin:"0"});var topMargin=modalOffset.top-modalOffsetBefore.top,bottomMargin=modalOuterHeight-modalInnerHeight-topMargin,leftMargin=modalOffset.left-modalOffsetBefore.left,rightMargin=modalOuterWidth-modalInnerWidth-leftMargin;var positionHorizontal=self.options.position.split(" ")[0],positionVertical=self.options.position.split(" ")[1],positionTop,positionBottom,positionLeft,positionRight;if(positionHorizontal==="left"){positionLeft=leftMargin+"px";if(self.$wrapperInner.width()<self.$modal.width()){positionRight=rightMargin+"px"}else{positionRight="auto"}}else if(positionHorizontal==="bottom"){positionRight=leftMargin+"px";if(self.$wrapperInner.width()<self.$modal.width()){positionLeft=leftMargin+"px"}else{positionLeft="auto"}}else{if(self.$wrapperInner.width()<self.$modal.width()+leftMargin+rightMargin){positionLeft=leftMargin+"px";positionRight=rightMargin+"px"}else{positionLeft=positionRight=self.$wrapperInner.innerWidth()/2-self.$modal.width()/2-leftMargin-rightMargin+"px"}}self.$modal.css({left:positionLeft,right:positionRight,width:self.$modal.width()-leftMargin-rightMargin});if(self.$wrapperInner.height()<self.$modal.height()){self.$wrapperInner.height(self.$modal.height()+topMargin+bottomMargin)}if(preserve_top||positionVertical==="top"){positionTop=topMargin+"px";if(self.$wrapperInner.height()<self.$modal.height()){positionBottom=bottomMargin+"px"}else{positionBottom="auto"}}else if(positionVertical==="bottom"){positionBottom=bottomMargin+"px";if(self.$wrapperInner.height()<self.$modal.height()){positionTop=topMargin+"px"}else{positionTop="auto"}}else{if(self.$wrapperInner.height()<self.$modal.height()){positionTop=topMargin+"px";positionBottom=bottomMargin+"px"}else{positionTop=positionBottom=self.$wrapperInner.height()/2-self.$modal.height()/2+"px"}}self.$modal.css({top:positionTop,bottom:positionBottom})}},show:function(){var self=this;if(!self.$el.hasClass(self.options.klassActive)){if(typeof self.$modal==="function"){self._$modal=self.$modal;self.$modal()}else{self.trigger("show");self.backdrop.show();self.$wrapper.show();self.$wrapper.parent().css("overflow","hidden");self.$el.addClass(self.options.klassActive);self.$modal.addClass(self.options.klassActive);registry.scan(self.$modal);self.positionModal();$(window.parent).on("resize.modal.patterns",function(){self.positionModal()});self.trigger("shown")}}},hide:function(){var self=this;if(self.ajaxXHR){self.ajaxXHR.abort()}if(self.$el.hasClass(self.options.klassActive)){self.trigger("hide");self.backdrop.hide();self.$wrapper.hide();self.$wrapper.parent().css("overflow","visible");self.$el.removeClass(self.options.klassActive);if(self.$modal.remove){self.$modal.remove();self.initModal()}$(window.parent).off("resize.modal.patterns");self.trigger("hidden")}}});return Modal});(function($){if(typeof $.fn.each2=="undefined"){$.fn.extend({each2:function(c){var j=$([0]),i=-1,l=this.length;while(++i<l&&(j.context=j[0]=this[i])&&c.call(j[0],i,j)!==false);return this}})}})(jQuery);(function($,undefined){if(window.Select2!==undefined){return}var KEY,AbstractSelect2,SingleSelect2,MultiSelect2,nextUid,sizer,lastMousePosition,$document;KEY={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(k){k=k.which?k.which:k;switch(k){case KEY.LEFT:case KEY.RIGHT:case KEY.UP:case KEY.DOWN:return true}return false},isControl:function(e){var k=e.which;switch(k){case KEY.SHIFT:case KEY.CTRL:case KEY.ALT:return true}if(e.metaKey)return true;return false},isFunctionKey:function(k){k=k.which?k.which:k;return k>=112&&k<=123}};$document=$(document);nextUid=function(){var counter=1;return function(){return counter++}}();function indexOf(value,array){var i=0,l=array.length,v;if(typeof value==="undefined"){return-1}if(value.constructor===String){for(;i<l;i=i+1)if(value.localeCompare(array[i])===0)return i}else{for(;i<l;i=i+1){v=array[i];if(v.constructor===String){if(v.localeCompare(value)===0)return i}else{if(v===value)return i}}}return-1}function equal(a,b){if(a===b)return true;if(a===undefined||b===undefined)return false;if(a===null||b===null)return false;if(a.constructor===String)return a.localeCompare(b)===0;if(b.constructor===String)return b.localeCompare(a)===0;return false}function splitVal(string,separator){var val,i,l;if(string===null||string.length<1)return[];val=string.split(separator);for(i=0,l=val.length;i<l;i=i+1)val[i]=$.trim(val[i]);return val}function getSideBorderPadding(element){return element.outerWidth(false)-element.width()}function installKeyUpChangeEvent(element){var key="keyup-change-value";element.bind("keydown",function(){if($.data(element,key)===undefined){$.data(element,key,element.val())}});element.bind("keyup",function(){var val=$.data(element,key);if(val!==undefined&&element.val()!==val){$.removeData(element,key);element.trigger("keyup-change")}})}$document.bind("mousemove",function(e){lastMousePosition={x:e.pageX,y:e.pageY}});function installFilteredMouseMove(element){element.bind("mousemove",function(e){var lastpos=lastMousePosition;if(lastpos===undefined||lastpos.x!==e.pageX||lastpos.y!==e.pageY){$(e.target).trigger("mousemove-filtered",e)}})}function debounce(quietMillis,fn,ctx){ctx=ctx||undefined;var timeout;return function(){var args=arguments;window.clearTimeout(timeout);timeout=window.setTimeout(function(){fn.apply(ctx,args)},quietMillis)}}function thunk(formula){var evaluated=false,value;return function(){if(evaluated===false){value=formula();evaluated=true}return value}}function installDebouncedScroll(threshold,element){var notify=debounce(threshold,function(e){element.trigger("scroll-debounced",e)});element.bind("scroll",function(e){if(indexOf(e.target,element.get())>=0)notify(e)})}function killEvent(event){event.preventDefault();event.stopPropagation()}function killEventImmediately(event){event.preventDefault();event.stopImmediatePropagation()}function measureTextWidth(e){if(!sizer){var style=e[0].currentStyle||window.getComputedStyle(e[0],null);sizer=$("<div></div>").css({position:"absolute",left:"-10000px",top:"-10000px",display:"none",fontSize:style.fontSize,fontFamily:style.fontFamily,fontStyle:style.fontStyle,fontWeight:style.fontWeight,letterSpacing:style.letterSpacing,textTransform:style.textTransform,whiteSpace:"nowrap"});$("body").append(sizer)}sizer.text(e.val());return sizer.width()}function markMatch(text,term,markup){var match=text.toUpperCase().indexOf(term.toUpperCase()),tl=term.length;if(match<0){markup.push(text);return}markup.push(text.substring(0,match));markup.push("<span class='select2-match'>");markup.push(text.substring(match,match+tl));markup.push("</span>");markup.push(text.substring(match+tl,text.length))}function ajax(options){var timeout,requestSequence=0,handler=null,quietMillis=options.quietMillis||100;return function(query){window.clearTimeout(timeout);timeout=window.setTimeout(function(){requestSequence+=1;var requestNumber=requestSequence,data=options.data,transport=options.transport||$.ajax,traditional=options.traditional||false,type=options.type||"GET";data=data.call(this,query.term,query.page,query.context);if(null!==handler){handler.abort()}handler=transport.call(null,{url:options.url,dataType:options.dataType,data:data,type:type,traditional:traditional,success:function(data){if(requestNumber<requestSequence){return}var results=options.results(data,query.page);query.callback(results)}})},quietMillis)}}function local(options){var data=options,dataText,text=function(item){return""+item.text};if(!$.isArray(data)){text=data.text;if(!$.isFunction(text)){dataText=data.text;text=function(item){return item[dataText]}}data=data.results}return function(query){var t=query.term,filtered={results:[]},process;if(t===""){query.callback({results:data});return}process=function(datum,collection){var group,attr;datum=datum[0];if(datum.children){group={};for(attr in datum){if(datum.hasOwnProperty(attr))group[attr]=datum[attr]}group.children=[];$(datum.children).each2(function(i,childDatum){process(childDatum,group.children)});if(group.children.length||query.matcher(t,text(group))){collection.push(group)}}else{if(query.matcher(t,text(datum))){collection.push(datum)}}};$(data).each2(function(i,datum){process(datum,filtered.results)});query.callback(filtered)}}function tags(data){if($.isFunction(data)){return data}return function(query){var t=query.term,filtered={results:[]};$(data).each(function(){var isObject=this.text!==undefined,text=isObject?this.text:this;if(t===""||query.matcher(t,text)){filtered.results.push(isObject?this:{id:this,text:this})}});query.callback(filtered)}}function checkFormatter(formatter,formatterName){if($.isFunction(formatter))return true;if(!formatter)return false;throw new Error("formatterName must be a function or a falsy value")}function evaluate(val){return $.isFunction(val)?val():val}function countResults(results){var count=0;$.each(results,function(i,item){if(item.children){count+=countResults(item.children)}else{count++}});return count}function defaultTokenizer(input,selection,selectCallback,opts){var original=input,dupe=false,token,index,i,l,separator;if(!opts.createSearchChoice||!opts.tokenSeparators||opts.tokenSeparators.length<1)return undefined;while(true){index=-1;for(i=0,l=opts.tokenSeparators.length;i<l;i++){separator=opts.tokenSeparators[i];index=input.indexOf(separator);if(index>=0)break}if(index<0)break;token=input.substring(0,index);input=input.substring(index+separator.length);if(token.length>0){token=opts.createSearchChoice(token,selection);if(token!==undefined&&token!==null&&opts.id(token)!==undefined&&opts.id(token)!==null){dupe=false;for(i=0,l=selection.length;i<l;i++){if(equal(opts.id(token),opts.id(selection[i]))){dupe=true;break}}if(!dupe)selectCallback(token)}}}if(original.localeCompare(input)!=0)return input}$document.ready(function(){$document.bind("mousedown touchend",function(e){var target=$(e.target).closest("div.select2-container").get(0),attr;if(target){$document.find("div.select2-container-active").each(function(){if(this!==target)$(this).data("select2").blur()})}else{target=$(e.target).closest("div.select2-drop").get(0);$document.find("div.select2-drop-active").each(function(){if(this!==target)$(this).data("select2").blur()})}target=$(e.target);attr=target.attr("for");if("LABEL"===e.target.tagName&&attr&&attr.length>0){attr=attr.replace(/([\[\].])/g,"\\$1");target=$("#"+attr);target=target.data("select2");if(target!==undefined){target.focus();e.preventDefault()}}})});function clazz(SuperClass,methods){var constructor=function(){};constructor.prototype=new SuperClass;constructor.prototype.constructor=constructor;constructor.prototype.parent=SuperClass.prototype;constructor.prototype=$.extend(constructor.prototype,methods);return constructor}AbstractSelect2=clazz(Object,{bind:function(func){var self=this;return function(){func.apply(self,arguments)}},init:function(opts){var results,search,resultsSelector=".select2-results";this.opts=opts=this.prepareOpts(opts);this.id=opts.id;if(opts.element.data("select2")!==undefined&&opts.element.data("select2")!==null){this.destroy()}this.enabled=true;this.container=this.createContainer();this.containerId="s2id_"+(opts.element.attr("id")||"autogen"+nextUid());this.containerSelector="#"+this.containerId.replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1");this.container.attr("id",this.containerId);this.body=thunk(function(){return opts.element.closest("body")});if(opts.element.attr("class")!==undefined){this.container.addClass(opts.element.attr("class").replace(/validate\[[\S ]+] ?/,""))}this.container.css(evaluate(opts.containerCss));this.container.addClass(evaluate(opts.containerCssClass));this.opts.element.data("select2",this).hide().before(this.container);this.container.data("select2",this);this.dropdown=this.container.find(".select2-drop");this.dropdown.addClass(evaluate(opts.dropdownCssClass));this.dropdown.data("select2",this);this.results=results=this.container.find(resultsSelector);this.search=search=this.container.find("input.select2-input");search.attr("tabIndex",this.opts.element.attr("tabIndex"));this.resultsPage=0;this.context=null;this.initContainer();this.initContainerWidth();installFilteredMouseMove(this.results);this.dropdown.delegate(resultsSelector,"mousemove-filtered",this.bind(this.highlightUnderEvent));installDebouncedScroll(80,this.results);this.dropdown.delegate(resultsSelector,"scroll-debounced",this.bind(this.loadMoreIfNeeded));if($.fn.mousewheel){results.mousewheel(function(e,delta,deltaX,deltaY){var top=results.scrollTop(),height;if(deltaY>0&&top-deltaY<=0){results.scrollTop(0);killEvent(e)}else if(deltaY<0&&results.get(0).scrollHeight-results.scrollTop()+deltaY<=results.height()){results.scrollTop(results.get(0).scrollHeight-results.height());killEvent(e)}})}installKeyUpChangeEvent(search);search.bind("keyup-change",this.bind(this.updateResults));search.bind("focus",function(){search.addClass("select2-focused");if(search.val()===" ")search.val("")});search.bind("blur",function(){search.removeClass("select2-focused")});this.dropdown.delegate(resultsSelector,"mouseup",this.bind(function(e){if($(e.target).closest(".select2-result-selectable:not(.select2-disabled)").length>0){this.highlightUnderEvent(e);this.selectHighlighted(e)}else{this.focusSearch()}killEvent(e)}));this.dropdown.bind("click mouseup mousedown",function(e){e.stopPropagation()});if($.isFunction(this.opts.initSelection)){this.initSelection();this.monitorSource()}if(opts.element.is(":disabled")||opts.element.is("[readonly='readonly']"))this.disable()},destroy:function(){var select2=this.opts.element.data("select2");if(select2!==undefined){select2.container.remove();select2.dropdown.remove();select2.opts.element.removeData("select2").unbind(".select2").show()}},prepareOpts:function(opts){var element,select,idKey,ajaxUrl;element=opts.element;if(element.get(0).tagName.toLowerCase()==="select"){this.select=select=opts.element}if(select){$.each(["id","multiple","ajax","query","createSearchChoice","initSelection","data","tags"],function(){if(this in opts){throw new Error("Option '"+this+"' is not allowed for Select2 when attached to a <select> element.")}})}opts=$.extend({},{populateResults:function(container,results,query){var populate,data,result,children,id=this.opts.id,self=this;populate=function(results,container,depth){var i,l,result,selectable,compound,node,label,innerContainer,formatted;for(i=0,l=results.length;i<l;i=i+1){result=results[i];selectable=id(result)!==undefined;compound=result.children&&result.children.length>0;node=$("<li></li>");node.addClass("select2-results-dept-"+depth);node.addClass("select2-result");node.addClass(selectable?"select2-result-selectable":"select2-result-unselectable");if(compound){node.addClass("select2-result-with-children")}node.addClass(self.opts.formatResultCssClass(result));label=$("<div></div>");label.addClass("select2-result-label");formatted=opts.formatResult(result,label,query);if(formatted!==undefined){label.html(self.opts.escapeMarkup(formatted))}node.append(label);if(compound){innerContainer=$("<ul></ul>");innerContainer.addClass("select2-result-sub");populate(result.children,innerContainer,depth+1);node.append(innerContainer)}node.data("select2-data",result);container.append(node)}};populate(results,container,0)}},$.fn.select2.defaults,opts);if(typeof opts.id!=="function"){idKey=opts.id;opts.id=function(e){return e[idKey]}}if(select){opts.query=this.bind(function(query){var data={results:[],more:false},term=query.term,children,firstChild,process;process=function(element,collection){var group;if(element.is("option")){if(query.matcher(term,element.text(),element)){collection.push({id:element.attr("value"),text:element.text(),element:element.get(),css:element.attr("class")})}}else if(element.is("optgroup")){group={text:element.attr("label"),children:[],element:element.get(),css:element.attr("class")};element.children().each2(function(i,elm){process(elm,group.children)});if(group.children.length>0){collection.push(group)}}};children=element.children();if(this.getPlaceholder()!==undefined&&children.length>0){firstChild=children[0];if($(firstChild).text()===""){children=children.not(firstChild)}}children.each2(function(i,elm){process(elm,data.results)});query.callback(data)});opts.id=function(e){return e.id};opts.formatResultCssClass=function(data){return data.css}}else{if(!("query"in opts)){if("ajax"in opts){ajaxUrl=opts.element.data("ajax-url");if(ajaxUrl&&ajaxUrl.length>0){opts.ajax.url=ajaxUrl}opts.query=ajax(opts.ajax)}else if("data"in opts){opts.query=local(opts.data)}else if("tags"in opts){opts.query=tags(opts.tags);opts.createSearchChoice=function(term){return{id:term,text:term}};opts.initSelection=function(element,callback){var data=[];$(splitVal(element.val(),opts.separator)).each(function(){var id=this,text=this,tags=opts.tags;if($.isFunction(tags))tags=tags();$(tags).each(function(){if(equal(this.id,id)){text=this.text;return false}});data.push({id:id,text:text})});callback(data)}}}}if(typeof opts.query!=="function"){throw"query function not defined for Select2 "+opts.element.attr("id")}return opts},monitorSource:function(){this.opts.element.bind("change.select2",this.bind(function(e){if(this.opts.element.data("select2-change-triggered")!==true){this.initSelection()}}))},triggerChange:function(details){details=details||{};details=$.extend({},details,{type:"change",val:this.val()});this.opts.element.data("select2-change-triggered",true);this.opts.element.trigger(details);this.opts.element.data("select2-change-triggered",false);this.opts.element.click();if(this.opts.blurOnChange)this.opts.element.blur()},enable:function(){if(this.enabled)return;this.enabled=true;this.container.removeClass("select2-container-disabled");
this.opts.element.removeAttr("disabled")},disable:function(){if(!this.enabled)return;this.close();this.enabled=false;this.container.addClass("select2-container-disabled");this.opts.element.attr("disabled","disabled")},opened:function(){return this.container.hasClass("select2-dropdown-open")},positionDropdown:function(){var offset=this.container.offset(),height=this.container.outerHeight(false),width=this.container.outerWidth(false),dropHeight=this.dropdown.outerHeight(false),viewportBottom=$(window).scrollTop()+document.documentElement.clientHeight,dropTop=offset.top+height,dropLeft=offset.left,enoughRoomBelow=dropTop+dropHeight<=viewportBottom,enoughRoomAbove=offset.top-dropHeight>=this.body().scrollTop(),aboveNow=this.dropdown.hasClass("select2-drop-above"),bodyOffset,above,css;if(this.body().css("position")!=="static"){bodyOffset=this.body().offset();dropTop-=bodyOffset.top;dropLeft-=bodyOffset.left}if(aboveNow){above=true;if(!enoughRoomAbove&&enoughRoomBelow)above=false}else{above=false;if(!enoughRoomBelow&&enoughRoomAbove)above=true}if(above){dropTop=offset.top-dropHeight;this.container.addClass("select2-drop-above");this.dropdown.addClass("select2-drop-above")}else{this.container.removeClass("select2-drop-above");this.dropdown.removeClass("select2-drop-above")}css=$.extend({top:dropTop,left:dropLeft,width:width},evaluate(this.opts.dropdownCss));this.dropdown.css(css)},shouldOpen:function(){var event;if(this.opened())return false;event=$.Event("open");this.opts.element.trigger(event);return!event.isDefaultPrevented()},clearDropdownAlignmentPreference:function(){this.container.removeClass("select2-drop-above");this.dropdown.removeClass("select2-drop-above")},open:function(){if(!this.shouldOpen())return false;window.setTimeout(this.bind(this.opening),1);return true},opening:function(){var cid=this.containerId,selector=this.containerSelector,scroll="scroll."+cid,resize="resize."+cid;this.container.parents().each(function(){$(this).bind(scroll,function(){var s2=$(selector);if(s2.length==0){$(this).unbind(scroll)}s2.select2("close")})});window.setTimeout(function(){$(window).bind(resize,function(){var s2=$(selector);if(s2.length==0){$(window).unbind(resize)}s2.select2("close")})},10);this.clearDropdownAlignmentPreference();if(this.search.val()===" "){this.search.val("")}this.container.addClass("select2-dropdown-open").addClass("select2-container-active");this.updateResults(true);if(this.dropdown[0]!==this.body().children().last()[0]){this.dropdown.detach().appendTo(this.body())}this.dropdown.show();this.positionDropdown();this.dropdown.addClass("select2-drop-active");this.ensureHighlightVisible();this.focusSearch()},close:function(){if(!this.opened())return;var self=this;this.container.parents().each(function(){$(this).unbind("scroll."+self.containerId)});$(window).unbind("resize."+this.containerId);this.clearDropdownAlignmentPreference();this.dropdown.hide();this.container.removeClass("select2-dropdown-open").removeClass("select2-container-active");this.results.empty();this.clearSearch();this.opts.element.trigger($.Event("close"))},clearSearch:function(){},ensureHighlightVisible:function(){var results=this.results,children,index,child,hb,rb,y,more;index=this.highlight();if(index<0)return;if(index==0){results.scrollTop(0);return}children=results.find(".select2-result-selectable");child=$(children[index]);hb=child.offset().top+child.outerHeight(true);if(index===children.length-1){more=results.find("li.select2-more-results");if(more.length>0){hb=more.offset().top+more.outerHeight(true)}}rb=results.offset().top+results.outerHeight(true);if(hb>rb){results.scrollTop(results.scrollTop()+(hb-rb))}y=child.offset().top-results.offset().top;if(y<0){results.scrollTop(results.scrollTop()+y)}},moveHighlight:function(delta){var choices=this.results.find(".select2-result-selectable"),index=this.highlight();while(index>-1&&index<choices.length){index+=delta;var choice=$(choices[index]);if(choice.hasClass("select2-result-selectable")&&!choice.hasClass("select2-disabled")){this.highlight(index);break}}},highlight:function(index){var choices=this.results.find(".select2-result-selectable").not(".select2-disabled");if(arguments.length===0){return indexOf(choices.filter(".select2-highlighted")[0],choices.get())}if(index>=choices.length)index=choices.length-1;if(index<0)index=0;choices.removeClass("select2-highlighted");$(choices[index]).addClass("select2-highlighted");this.ensureHighlightVisible()},countSelectableResults:function(){return this.results.find(".select2-result-selectable").not(".select2-disabled").length},highlightUnderEvent:function(event){var el=$(event.target).closest(".select2-result-selectable");if(el.length>0&&!el.is(".select2-highlighted")){var choices=this.results.find(".select2-result-selectable");this.highlight(choices.index(el))}else if(el.length==0){this.results.find(".select2-highlighted").removeClass("select2-highlighted")}},loadMoreIfNeeded:function(){var results=this.results,more=results.find("li.select2-more-results"),below,offset=-1,page=this.resultsPage+1,self=this,term=this.search.val(),context=this.context;if(more.length===0)return;below=more.offset().top-results.offset().top-results.height();if(below<=0){more.addClass("select2-active");this.opts.query({term:term,page:page,context:context,matcher:this.opts.matcher,callback:this.bind(function(data){if(!self.opened())return;self.opts.populateResults.call(this,results,data.results,{term:term,page:page,context:context});if(data.more===true){more.detach().appendTo(results).text(self.opts.formatLoadMore(page+1));window.setTimeout(function(){self.loadMoreIfNeeded()},10)}else{more.remove()}self.positionDropdown();self.resultsPage=page})})}},tokenize:function(){},updateResults:function(initial){var search=this.search,results=this.results,opts=this.opts,data,self=this,input;if(initial!==true&&(this.showSearchInput===false||!this.opened())){return}search.addClass("select2-active");function postRender(){results.scrollTop(0);search.removeClass("select2-active");self.positionDropdown()}function render(html){results.html(self.opts.escapeMarkup(html));postRender()}if(opts.maximumSelectionSize>=1){data=this.data();if($.isArray(data)&&data.length>=opts.maximumSelectionSize&&checkFormatter(opts.formatSelectionTooBig,"formatSelectionTooBig")){render("<li class='select2-selection-limit'>"+opts.formatSelectionTooBig(opts.maximumSelectionSize)+"</li>");return}}if(search.val().length<opts.minimumInputLength){if(checkFormatter(opts.formatInputTooShort,"formatInputTooShort")){render("<li class='select2-no-results'>"+opts.formatInputTooShort(search.val(),opts.minimumInputLength)+"</li>")}else{render("")}return}else if(opts.formatSearching()){render("<li class='select2-searching'>"+opts.formatSearching()+"</li>")}input=this.tokenize();if(input!=undefined&&input!=null){search.val(input)}this.resultsPage=1;opts.query({term:search.val(),page:this.resultsPage,context:null,matcher:opts.matcher,callback:this.bind(function(data){var def;if(!this.opened())return;this.context=data.context===undefined?null:data.context;if(this.opts.createSearchChoice&&search.val()!==""){def=this.opts.createSearchChoice.call(null,search.val(),data.results);if(def!==undefined&&def!==null&&self.id(def)!==undefined&&self.id(def)!==null){if($(data.results).filter(function(){return equal(self.id(this),self.id(def))}).length===0){data.results.unshift(def)}}}if(data.results.length===0&&checkFormatter(opts.formatNoMatches,"formatNoMatches")){render("<li class='select2-no-results'>"+opts.formatNoMatches(search.val())+"</li>");return}results.empty();self.opts.populateResults.call(this,results,data.results,{term:search.val(),page:this.resultsPage,context:null});if(data.more===true&&checkFormatter(opts.formatLoadMore,"formatLoadMore")){results.append("<li class='select2-more-results'>"+self.opts.escapeMarkup(opts.formatLoadMore(this.resultsPage))+"</li>");window.setTimeout(function(){self.loadMoreIfNeeded()},10)}this.postprocessResults(data,initial);postRender()})})},cancel:function(){this.close()},blur:function(){this.close();this.container.removeClass("select2-container-active");this.dropdown.removeClass("select2-drop-active");if(this.search[0]===document.activeElement){this.search.blur()}this.clearSearch();this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");this.opts.element.triggerHandler("blur")},focusSearch:function(){this.search.show();this.search.focus();window.setTimeout(this.bind(function(){this.search.show();this.search.focus();this.search.val(this.search.val())}),10)},selectHighlighted:function(){var index=this.highlight(),highlighted=this.results.find(".select2-highlighted").not(".select2-disabled"),data=highlighted.closest(".select2-result-selectable").data("select2-data");if(data){highlighted.addClass("select2-disabled");this.highlight(index);this.onSelect(data)}},getPlaceholder:function(){return this.opts.element.attr("placeholder")||this.opts.element.attr("data-placeholder")||this.opts.element.data("placeholder")||this.opts.placeholder},initContainerWidth:function(){function resolveContainerWidth(){var style,attrs,matches,i,l;if(this.opts.width==="off"){return null}else if(this.opts.width==="element"){return this.opts.element.outerWidth(false)===0?"auto":this.opts.element.outerWidth(false)+"px"}else if(this.opts.width==="copy"||this.opts.width==="resolve"){style=this.opts.element.attr("style");if(style!==undefined){attrs=style.split(";");for(i=0,l=attrs.length;i<l;i=i+1){matches=attrs[i].replace(/\s/g,"").match(/width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/);if(matches!==null&&matches.length>=1)return matches[1]}}if(this.opts.width==="resolve"){style=this.opts.element.css("width");if(style.indexOf("%")>0)return style;return this.opts.element.outerWidth(false)===0?"auto":this.opts.element.outerWidth(false)+"px"}return null}else if($.isFunction(this.opts.width)){return this.opts.width()}else{return this.opts.width}}var width=resolveContainerWidth.call(this);if(width!==null){this.container.attr("style","width: "+width)}}});SingleSelect2=clazz(AbstractSelect2,{createContainer:function(){var container=$("<div></div>",{"class":"select2-container"}).html(["    <a href='javascript:void(0)' onclick='return false;' class='select2-choice'>","   <span></span><abbr class='select2-search-choice-close' style='display:none;'></abbr>","   <div><b></b></div>","</a>","    <div class='select2-drop select2-offscreen'>","   <div class='select2-search'>","       <input type='text' autocomplete='off' class='select2-input'/>","   </div>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return container},opening:function(){this.search.show();this.parent.opening.apply(this,arguments);this.dropdown.removeClass("select2-offscreen")},close:function(){if(!this.opened())return;this.parent.close.apply(this,arguments);this.dropdown.removeAttr("style").addClass("select2-offscreen").insertAfter(this.selection).show()},focus:function(){this.close();this.selection.focus()},isFocused:function(){return this.selection[0]===document.activeElement},cancel:function(){this.parent.cancel.apply(this,arguments);this.selection.focus()},initContainer:function(){var selection,container=this.container,dropdown=this.dropdown,clickingInside=false;this.selection=selection=container.find(".select2-choice");this.search.bind("keydown",this.bind(function(e){if(!this.enabled)return;if(e.which===KEY.PAGE_UP||e.which===KEY.PAGE_DOWN){killEvent(e);return}if(this.opened()){switch(e.which){case KEY.UP:case KEY.DOWN:this.moveHighlight(e.which===KEY.UP?-1:1);killEvent(e);return;case KEY.TAB:case KEY.ENTER:this.selectHighlighted();killEvent(e);return;case KEY.ESC:this.cancel(e);killEvent(e);return}}else{if(e.which===KEY.TAB||KEY.isControl(e)||KEY.isFunctionKey(e)||e.which===KEY.ESC){return}if(this.opts.openOnEnter===false&&e.which===KEY.ENTER){return}this.open();if(e.which===KEY.ENTER){return}}}));this.search.bind("focus",this.bind(function(){this.selection.attr("tabIndex","-1")}));this.search.bind("blur",this.bind(function(){if(!this.opened())this.container.removeClass("select2-container-active");window.setTimeout(this.bind(function(){var ti=this.opts.element.attr("tabIndex");if(ti){this.selection.attr("tabIndex",ti)}else{this.selection.removeAttr("tabIndex")}}),10)}));selection.delegate("abbr","mousedown",this.bind(function(e){if(!this.enabled)return;this.clear();killEventImmediately(e);this.close();this.triggerChange();this.selection.focus()}));selection.bind("mousedown",this.bind(function(e){clickingInside=true;if(this.opened()){this.close();this.selection.focus()}else if(this.enabled){this.open()}clickingInside=false}));dropdown.bind("mousedown",this.bind(function(){this.search.focus()}));selection.bind("focus",this.bind(function(){this.container.addClass("select2-container-active");this.search.attr("tabIndex","-1")}));selection.bind("blur",this.bind(function(){if(!this.opened()){this.container.removeClass("select2-container-active")}window.setTimeout(this.bind(function(){this.search.attr("tabIndex",this.opts.element.attr("tabIndex"))}),10)}));selection.bind("keydown",this.bind(function(e){if(!this.enabled)return;if(e.which==KEY.DOWN||e.which==KEY.UP||e.which==KEY.ENTER&&this.opts.openOnEnter){this.open();killEvent(e);return}if(e.which==KEY.DELETE||e.which==KEY.BACKSPACE){if(this.opts.allowClear){this.clear()}killEvent(e);return}}));selection.bind("keypress",this.bind(function(e){var key=String.fromCharCode(e.which);this.search.val(key);this.open()}));this.setPlaceholder();this.search.bind("focus",this.bind(function(){this.container.addClass("select2-container-active")}))},clear:function(){this.opts.element.val("");this.selection.find("span").empty();this.selection.removeData("select2-data");this.setPlaceholder()},initSelection:function(){var selected;if(this.opts.element.val()===""&&this.opts.element.text()===""){this.close();this.setPlaceholder()}else{var self=this;this.opts.initSelection.call(null,this.opts.element,function(selected){if(selected!==undefined&&selected!==null){self.updateSelection(selected);self.close();self.setPlaceholder()}})}},prepareOpts:function(){var opts=this.parent.prepareOpts.apply(this,arguments);if(opts.element.get(0).tagName.toLowerCase()==="select"){opts.initSelection=function(element,callback){var selected=element.find(":selected");if($.isFunction(callback))callback({id:selected.attr("value"),text:selected.text(),element:selected})}}return opts},setPlaceholder:function(){var placeholder=this.getPlaceholder();if(this.opts.element.val()===""&&placeholder!==undefined){if(this.select&&this.select.find("option:first").text()!=="")return;this.selection.find("span").html(this.opts.escapeMarkup(placeholder));this.selection.addClass("select2-default");this.selection.find("abbr").hide()}},postprocessResults:function(data,initial){var selected=0,self=this,showSearchInput=true;this.results.find(".select2-result-selectable").each2(function(i,elm){if(equal(self.id(elm.data("select2-data")),self.opts.element.val())){selected=i;return false}});this.highlight(selected);if(initial===true){showSearchInput=this.showSearchInput=countResults(data.results)>=this.opts.minimumResultsForSearch;this.dropdown.find(".select2-search")[showSearchInput?"removeClass":"addClass"]("select2-search-hidden");$(this.dropdown,this.container)[showSearchInput?"addClass":"removeClass"]("select2-with-searchbox")}},onSelect:function(data){var old=this.opts.element.val();this.opts.element.val(this.id(data));this.updateSelection(data);this.close();this.selection.focus();if(!equal(old,this.id(data))){this.triggerChange()}},updateSelection:function(data){var container=this.selection.find("span"),formatted;this.selection.data("select2-data",data);container.empty();formatted=this.opts.formatSelection(data,container);if(formatted!==undefined){container.append(this.opts.escapeMarkup(formatted))}this.selection.removeClass("select2-default");if(this.opts.allowClear&&this.getPlaceholder()!==undefined){this.selection.find("abbr").show()}},val:function(){var val,data=null,self=this;if(arguments.length===0){return this.opts.element.val()}val=arguments[0];if(this.select){this.select.val(val).find(":selected").each2(function(i,elm){data={id:elm.attr("value"),text:elm.text()};return false});this.updateSelection(data);this.setPlaceholder()}else{if(this.opts.initSelection===undefined){throw new Error("cannot call val() if initSelection() is not defined")}if(!val){this.clear();return}this.opts.element.val(val);this.opts.initSelection(this.opts.element,function(data){self.opts.element.val(!data?"":self.id(data));self.updateSelection(data);self.setPlaceholder()})}},clearSearch:function(){this.search.val("")},data:function(value){var data;if(arguments.length===0){data=this.selection.data("select2-data");if(data==undefined)data=null;return data}else{if(!value||value===""){this.clear()}else{this.opts.element.val(!value?"":this.id(value));this.updateSelection(value)}}}});MultiSelect2=clazz(AbstractSelect2,{createContainer:function(){var container=$("<div></div>",{"class":"select2-container select2-container-multi"}).html(["    <ul class='select2-choices'>","  <li class='select2-search-field'>","    <input type='text' autocomplete='off' class='select2-input'>","  </li>","</ul>","<div class='select2-drop select2-drop-multi' style='display:none;'>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return container},prepareOpts:function(){var opts=this.parent.prepareOpts.apply(this,arguments);if(opts.element.get(0).tagName.toLowerCase()==="select"){opts.initSelection=function(element,callback){var data=[];element.find(":selected").each2(function(i,elm){data.push({id:elm.attr("value"),text:elm.text(),element:elm})});if($.isFunction(callback))callback(data)}}return opts},initContainer:function(){var selector=".select2-choices",selection;this.searchContainer=this.container.find(".select2-search-field");this.selection=selection=this.container.find(selector);this.search.bind("keydown",this.bind(function(e){if(!this.enabled)return;if(e.which===KEY.BACKSPACE&&this.search.val()===""){this.close();var choices,selected=selection.find(".select2-search-choice-focus");if(selected.length>0){this.unselect(selected.first());this.search.width(10);killEvent(e);return}choices=selection.find(".select2-search-choice:not(.select2-locked)");if(choices.length>0){choices.last().addClass("select2-search-choice-focus")}}else{selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus")}if(this.opened()){switch(e.which){case KEY.UP:case KEY.DOWN:this.moveHighlight(e.which===KEY.UP?-1:1);killEvent(e);return;case KEY.ENTER:case KEY.TAB:this.selectHighlighted();killEvent(e);return;case KEY.ESC:this.cancel(e);killEvent(e);return}}if(e.which===KEY.TAB||KEY.isControl(e)||KEY.isFunctionKey(e)||e.which===KEY.BACKSPACE||e.which===KEY.ESC){return}if(this.opts.openOnEnter===false&&e.which===KEY.ENTER){return}this.open();if(e.which===KEY.PAGE_UP||e.which===KEY.PAGE_DOWN){killEvent(e)}}));this.search.bind("keyup",this.bind(this.resizeSearch));this.search.bind("blur",this.bind(function(e){this.container.removeClass("select2-container-active");this.search.removeClass("select2-focused");this.clearSearch();e.stopImmediatePropagation()}));this.container.delegate(selector,"mousedown",this.bind(function(e){if(!this.enabled)return;if($(e.target).closest(".select2-search-choice").length>0){return}this.clearPlaceholder();this.open();this.focusSearch();e.preventDefault()}));this.container.delegate(selector,"focus",this.bind(function(){if(!this.enabled)return;this.container.addClass("select2-container-active");this.dropdown.addClass("select2-drop-active");this.clearPlaceholder()}));this.clearSearch()},enable:function(){if(this.enabled)return;this.parent.enable.apply(this,arguments);this.search.removeAttr("disabled")},disable:function(){if(!this.enabled)return;this.parent.disable.apply(this,arguments);this.search.attr("disabled",true)},initSelection:function(){var data;if(this.opts.element.val()===""&&this.opts.element.text()===""){this.updateSelection([]);this.close();this.clearSearch()}if(this.select||this.opts.element.val()!==""){var self=this;this.opts.initSelection.call(null,this.opts.element,function(data){if(data!==undefined&&data!==null){self.updateSelection(data);self.close();self.clearSearch()}})}},clearSearch:function(){var placeholder=this.getPlaceholder();if(placeholder!==undefined&&this.getVal().length===0&&this.search.hasClass("select2-focused")===false){this.search.val(placeholder).addClass("select2-default");this.resizeSearch()}else{this.search.val(" ").width(10)}},clearPlaceholder:function(){if(this.search.hasClass("select2-default")){this.search.val("").removeClass("select2-default")}else{if(this.search.val()===" ")this.search.val("")}},opening:function(){this.parent.opening.apply(this,arguments);this.clearPlaceholder();this.resizeSearch();this.focusSearch()},close:function(){if(!this.opened())return;this.parent.close.apply(this,arguments)},focus:function(){this.close();this.search.focus()},isFocused:function(){return this.search.hasClass("select2-focused")},updateSelection:function(data){var ids=[],filtered=[],self=this;$(data).each(function(){if(indexOf(self.id(this),ids)<0){ids.push(self.id(this));filtered.push(this)}});data=filtered;this.selection.find(".select2-search-choice").remove();$(data).each(function(){self.addSelectedChoice(this)});self.postprocessResults()},tokenize:function(){var input=this.search.val();input=this.opts.tokenizer(input,this.data(),this.bind(this.onSelect),this.opts);if(input!=null&&input!=undefined){this.search.val(input);if(input.length>0){this.open()}}},onSelect:function(data){this.addSelectedChoice(data);if(this.select||!this.opts.closeOnSelect)this.postprocessResults();if(this.opts.closeOnSelect){this.close();this.search.width(10)}else{if(this.countSelectableResults()>0){this.search.width(10);this.resizeSearch();this.positionDropdown()}else{this.close()}}this.triggerChange({added:data});this.focusSearch()},cancel:function(){this.close();this.focusSearch()},addSelectedChoice:function(data){var enableChoice=!data.locked,enabledItem=$("<li class='select2-search-choice'>"+"    <div></div>"+"    <a href='#' onclick='return false;' class='select2-search-choice-close' tabindex='-1'></a>"+"</li>"),disabledItem=$("<li class='select2-search-choice select2-locked'>"+"<div></div>"+"</li>");var choice=enableChoice?enabledItem:disabledItem,id=this.id(data),val=this.getVal(),formatted;formatted=this.opts.formatSelection(data,choice.find("div"));if(formatted!=undefined){choice.find("div").replaceWith("<div>"+this.opts.escapeMarkup(formatted)+"</div>")}if(enableChoice){choice.find(".select2-search-choice-close").bind("mousedown",killEvent).bind("click dblclick",this.bind(function(e){if(!this.enabled)return;$(e.target).closest(".select2-search-choice").fadeOut("fast",this.bind(function(){this.unselect($(e.target));this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");this.close();this.focusSearch()})).dequeue();killEvent(e)})).bind("focus",this.bind(function(){if(!this.enabled)return;this.container.addClass("select2-container-active");this.dropdown.addClass("select2-drop-active")}))}choice.data("select2-data",data);choice.insertBefore(this.searchContainer);val.push(id);this.setVal(val)},unselect:function(selected){var val=this.getVal(),data,index;selected=selected.closest(".select2-search-choice");if(selected.length===0){throw"Invalid argument: "+selected+". Must be .select2-search-choice"}data=selected.data("select2-data");index=indexOf(this.id(data),val);if(index>=0){val.splice(index,1);this.setVal(val);if(this.select)this.postprocessResults()}selected.remove();this.triggerChange({removed:data})},postprocessResults:function(){var val=this.getVal(),choices=this.results.find(".select2-result-selectable"),compound=this.results.find(".select2-result-with-children"),self=this;choices.each2(function(i,choice){var id=self.id(choice.data("select2-data"));if(indexOf(id,val)>=0){choice.addClass("select2-disabled").removeClass("select2-result-selectable")}else{choice.removeClass("select2-disabled").addClass("select2-result-selectable")}});compound.each2(function(i,e){if(!e.is(".select2-result-selectable")&&e.find(".select2-result-selectable").length==0){e.addClass("select2-disabled")}else{e.removeClass("select2-disabled")}});choices.each2(function(i,choice){if(!choice.hasClass("select2-disabled")&&choice.hasClass("select2-result-selectable")){self.highlight(0);return false}})},resizeSearch:function(){var minimumWidth,left,maxWidth,containerLeft,searchWidth,sideBorderPadding=getSideBorderPadding(this.search);minimumWidth=measureTextWidth(this.search)+10;left=this.search.offset().left;maxWidth=this.selection.width();containerLeft=this.selection.offset().left;searchWidth=maxWidth-(left-containerLeft)-sideBorderPadding;if(searchWidth<minimumWidth){searchWidth=maxWidth-sideBorderPadding}if(searchWidth<40){searchWidth=maxWidth-sideBorderPadding}this.search.width(searchWidth)},getVal:function(){var val;if(this.select){val=this.select.val();return val===null?[]:val}else{val=this.opts.element.val();return splitVal(val,this.opts.separator)}},setVal:function(val){var unique;if(this.select){this.select.val(val)}else{unique=[];$(val).each(function(){if(indexOf(this,unique)<0)unique.push(this)});this.opts.element.val(unique.length===0?"":unique.join(this.opts.separator))}},val:function(){var val,data=[],self=this;if(arguments.length===0){return this.getVal()}val=arguments[0];if(!val){this.opts.element.val("");this.updateSelection([]);this.clearSearch();return}this.setVal(val);if(this.select){this.select.find(":selected").each(function(){data.push({id:$(this).attr("value"),text:$(this).text()})});this.updateSelection(data)}else{if(this.opts.initSelection===undefined){throw new Error("val() cannot be called if initSelection() is not defined")}this.opts.initSelection(this.opts.element,function(data){var ids=$(data).map(self.id);self.setVal(ids);self.updateSelection(data);self.clearSearch()})}this.clearSearch()},onSortStart:function(){if(this.select){throw new Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.")}this.search.width(0);this.searchContainer.hide()},onSortEnd:function(){var val=[],self=this;this.searchContainer.show();this.searchContainer.appendTo(this.searchContainer.parent());this.resizeSearch();this.selection.find(".select2-search-choice").each(function(){val.push(self.opts.id($(this).data("select2-data")))});this.setVal(val);this.triggerChange()},data:function(values){var self=this,ids;if(arguments.length===0){return this.selection.find(".select2-search-choice").map(function(){return $(this).data("select2-data")}).get()}else{if(!values){values=[]}ids=$.map(values,function(e){return self.opts.id(e)});this.setVal(ids);this.updateSelection(values);this.clearSearch()}}});$.fn.select2=function(){var args=Array.prototype.slice.call(arguments,0),opts,select2,value,multiple,allowedMethods=["val","destroy","opened","open","close","focus","isFocused","container","onSortStart","onSortEnd","enable","disable","positionDropdown","data"];this.each(function(){if(args.length===0||typeof args[0]==="object"){opts=args.length===0?{}:$.extend({},args[0]);opts.element=$(this);if(opts.element.get(0).tagName.toLowerCase()==="select"){multiple=opts.element.attr("multiple")}else{multiple=opts.multiple||false;if("tags"in opts){opts.multiple=multiple=true}}select2=multiple?new MultiSelect2:new SingleSelect2;select2.init(opts)}else if(typeof args[0]==="string"){if(indexOf(args[0],allowedMethods)<0){throw"Unknown method: "+args[0]}value=undefined;select2=$(this).data("select2");if(select2===undefined)return;if(args[0]==="container"){value=select2.container}else{value=select2[args[0]].apply(select2,args.slice(1))}if(value!==undefined){return false}}else{throw"Invalid arguments to select2 plugin: "+args}});return value===undefined?this:value};$.fn.select2.defaults={width:"copy",closeOnSelect:true,openOnEnter:true,containerCss:{},dropdownCss:{},containerCssClass:"",dropdownCssClass:"",formatResult:function(result,container,query){var markup=[];markMatch(result.text,query.term,markup);return markup.join("")},formatSelection:function(data,container){return data?data.text:undefined},formatResultCssClass:function(data){return undefined},formatNoMatches:function(){return"No matches found"},formatInputTooShort:function(input,min){return"Please enter "+(min-input.length)+" more characters"},formatSelectionTooBig:function(limit){return"You can only select "+limit+" item"+(limit==1?"":"s")},formatLoadMore:function(pageNumber){return"Loading more results..."},formatSearching:function(){return"Searching..."},minimumResultsForSearch:0,minimumInputLength:0,maximumSelectionSize:0,id:function(e){return e.id},matcher:function(term,text){return text.toUpperCase().indexOf(term.toUpperCase())>=0},separator:",",tokenSeparators:[],tokenizer:defaultTokenizer,escapeMarkup:function(markup){if(markup&&typeof markup==="string"){return markup.replace(/&/g,"&amp;")}return markup},blurOnChange:false};window.Select2={query:{ajax:ajax,local:local,tags:tags},util:{debounce:debounce,markMatch:markMatch},"class":{"abstract":AbstractSelect2,single:SingleSelect2,multi:MultiSelect2}}})(jQuery);define("jam/select2/select2",function(){});define("js/patterns/select2",["jquery","js/patterns/base","jam/select2/select2"],function($,Base){var Select2=Base.extend({name:"select2",defaults:{},init:function(){var self=this;if(self.options.initselection){self.options.initSelection=function($el,callback){var data=[],value=$el.val(),initSelection=self.options.initselection;if(typeof initSelection==="string"){initSelection=JSON.parse(self.options.initselection)}$(value.split(",")).each(function(){var text=this;if(initSelection[this]){text=initSelection[this]}data.push({id:this,text:text})});callback(data)}}if(self.options.ajax||self.options.ajax_suggest){if(self.options.ajax_suggest){self.options.multiple=true;self.options.ajax=self.options.ajax||{};self.options.ajax.url=self.options.ajax_suggest;self.options.initSelection=function($el,callback){var data=[],value=$el.val();$(value.split(",")).each(function(){data.push({id:this,text:this})});callback(data)}}var query_term="";self.options.ajax=$.extend({quietMillis:300,data:function(term,page){query_term=term;return{query:term,page_limit:10,page:page}},results:function(data,page){var results=data.results;if(self.options.ajax_suggest){var data_ids=[];$.each(data.results,function(i,item){data_ids.push(item.id)});results=[];if(query_term!==""&&$.inArray(query_term,data_ids)===-1){results.push({id:query_term,text:query_term})}$.each(data.results,function(i,item){if(self.options.ajax_suggest){results.push({id:item.text,text:item.text})}else{results.push(item)}})}return{results:results}}},self.options.ajax)}if(self.options.tags&&typeof self.options==="string"){if(self.options.tags.substr(0,1)==="["){self.options.tags=JSON.parse(self.options.tags)}else{self.options.tags=self.options.tags.split(",")}}self.$el.select2(self.options);self.$el.parent().off("close.modal.patterns")}});return Select2});(function($,document,undefined){var DAYS_IN_WEEK=7,WEEKS_IN_CALENDAR=6,DAYS_IN_CALENDAR=WEEKS_IN_CALENDAR*DAYS_IN_WEEK,STRING_DIV="div",STRING_PREFIX_DATEPICKER="pickadate__",isIE=navigator.userAgent.match(/MSIE/),$document=$(document),$body=$(document.body),Picker=function($ELEMENT,SETTINGS){var Picker=function(){},P=Picker.prototype={constructor:Picker,$node:$ELEMENT,init:function(){$ELEMENT.on({"focus click":function(){if(!isIE||isIE&&!CALENDAR._IE){P.open()}$HOLDER.addClass(CLASSES.focused);CALENDAR._IE=0},blur:function(){$HOLDER.removeClass(CLASSES.focused)},keydown:function(event){var keycode=event.keyCode,isKeycodeDelete=keycode==8||keycode==46;if(isKeycodeDelete||!CALENDAR.isOpen&&KEYCODE_TO_DATE[keycode]){event.preventDefault();
event.stopPropagation();if(isKeycodeDelete){P.clear().close()}else{P.open()}}}}).after([$HOLDER,ELEMENT_HIDDEN]);if(ELEMENT.autofocus){P.open()}postRender();triggerFunction(SETTINGS.onStart,P);return P},open:function(){if(CALENDAR.isOpen)return P;CALENDAR.isOpen=true;toggleCalendarElements(0);$ELEMENT.focus().addClass(CLASSES.inputActive);$HOLDER.addClass(CLASSES.opened);$body.addClass(CLASSES.bodyActive);$document.on("focusin.P"+CALENDAR.id,function(event){if(!$HOLDER.find(event.target).length&&event.target!=ELEMENT)P.close()}).on("click.P"+CALENDAR.id,function(event){if(event.target!=ELEMENT)P.close()}).on("keydown.P"+CALENDAR.id,function(event){var keycode=event.keyCode,keycodeToDate=KEYCODE_TO_DATE[keycode];if(keycode==27){ELEMENT.focus();P.close()}else if(event.target==ELEMENT&&(keycodeToDate||keycode==13)){event.preventDefault();if(keycodeToDate){setDateSelected(createValidatedDate([MONTH_FOCUSED.YEAR,MONTH_FOCUSED.MONTH,DATE_HIGHLIGHTED.DATE+keycodeToDate],keycodeToDate),1)}else{setElementsValue(DATE_HIGHLIGHTED);calendarRender();P.close()}}});triggerFunction(SETTINGS.onOpen,P);return P},close:function(){if(!CALENDAR.isOpen)return P;CALENDAR.isOpen=false;toggleCalendarElements(-1);$ELEMENT.removeClass(CLASSES.inputActive);$HOLDER.removeClass(CLASSES.opened);$body.removeClass(CLASSES.bodyActive);$document.off(".P"+CALENDAR.id);triggerFunction(SETTINGS.onClose,P);return P},show:function(month,year){showMonth(--month,year);return P},clear:function(){setElementsValue(0);calendarRender();return P},getDate:function(format){if(!ELEMENT.value){return""}if(format===true){return DATE_SELECTED.OBJ}return getDateFormatted(format)},setDate:function(year,month,date,isSuperficial){setDateSelected(createValidatedDate([year,--month,date]),isSuperficial);return P},getDateLimit:function(upper,format){return getDateFormatted(format,upper?DATE_MAX:DATE_MIN)},setDateLimit:function(limit,upper){if(upper){DATE_MAX=createBoundaryDate(limit,upper);if(MONTH_FOCUSED.TIME>DATE_MAX.TIME){MONTH_FOCUSED=DATE_MAX}}else{DATE_MIN=createBoundaryDate(limit);if(MONTH_FOCUSED.TIME<DATE_MIN.TIME){MONTH_FOCUSED=DATE_MIN}}calendarRender();return P}},ELEMENT=function(element){element.autofocus=element==document.activeElement;element.type="text";element.readOnly=true;return element}($ELEMENT[0]),CALENDAR={id:~~(Math.random()*1e9)},CLASSES=SETTINGS.klass,DATE_FORMATS=function(){function getFirstWordLength(string){return string.match(/\w+/)[0].length}function getDigitsLength(string){return/\d/.test(string[1])?2:1}function getMonthLength(string,dateObj,collection){var word=string.match(/\w+/)[0];if(!dateObj.mm&&!dateObj.m){dateObj.m=collection.indexOf(word)+1}return word.length}return{d:function(string){return string?getDigitsLength(string):this.DATE},dd:function(string){return string?2:leadZero(this.DATE)},ddd:function(string){return string?getFirstWordLength(string):SETTINGS.weekdaysShort[this.DAY]},dddd:function(string){return string?getFirstWordLength(string):SETTINGS.weekdaysFull[this.DAY]},m:function(string){return string?getDigitsLength(string):this.MONTH+1},mm:function(string){return string?2:leadZero(this.MONTH+1)},mmm:function(string,dateObject){var collection=SETTINGS.monthsShort;return string?getMonthLength(string,dateObject,collection):collection[this.MONTH]},mmmm:function(string,dateObject){var collection=SETTINGS.monthsFull;return string?getMonthLength(string,dateObject,collection):collection[this.MONTH]},yy:function(string){return string?2:(""+this.YEAR).slice(2)},yyyy:function(string){return string?4:this.YEAR},toArray:function(format){return format.split(/(?=\b)(d{1,4}|m{1,4}|y{4}|yy)+(\b)/g)}}}(),DATE_TODAY=createDate(),DATE_MIN=createBoundaryDate(SETTINGS.dateMin),DATE_MAX=createBoundaryDate(SETTINGS.dateMax,1),DATES_TO_DISABLE=function(datesCollection){if(Array.isArray(datesCollection)){if(datesCollection[0]===true){CALENDAR.disabled=datesCollection.shift()}return datesCollection.map(function(date){if(!isNaN(date)){return--date+SETTINGS.firstDay}--date[1];return createDate(date)})}}(SETTINGS.datesDisabled),DISABLED_DATES=function(){var isDisabledDate=function(date){return this.TIME==date.TIME||DATES_TO_DISABLE.indexOf(this.DAY)>-1};return CALENDAR.disabled?function(date,i,collection){return collection.map(isDisabledDate,this).indexOf(true)<0}:isDisabledDate}(),DATE_HIGHLIGHTED=function(dateDataValue,dateEntered){if(dateDataValue){dateEntered={};DATE_FORMATS.toArray(SETTINGS.formatSubmit).map(function(formatItem){var formattingLength=DATE_FORMATS[formatItem]?DATE_FORMATS[formatItem](dateDataValue,dateEntered):formatItem.length;if(DATE_FORMATS[formatItem]){dateEntered[formatItem]=dateDataValue.slice(0,formattingLength)}dateDataValue=dateDataValue.slice(formattingLength)});dateEntered=[+(dateEntered.yyyy||dateEntered.yy),+(dateEntered.mm||dateEntered.m)-1,+(dateEntered.dd||dateEntered.d)]}else{dateEntered=Date.parse(dateEntered)}return createValidatedDate(dateEntered&&(!isNaN(dateEntered)||Array.isArray(dateEntered))?dateEntered:DATE_TODAY)}(ELEMENT.getAttribute("data-value"),ELEMENT.value),DATE_SELECTED=DATE_HIGHLIGHTED,MONTH_FOCUSED=DATE_HIGHLIGHTED,ELEMENT_HIDDEN=SETTINGS.formatSubmit?$("<input type=hidden name="+ELEMENT.name+SETTINGS.hiddenSuffix+">").val(ELEMENT.value?getDateFormatted(SETTINGS.formatSubmit):"")[0]:null,TABLE_HEAD=function(weekdaysCollection){if(SETTINGS.firstDay){weekdaysCollection.push(weekdaysCollection.splice(0,1)[0])}return createNode("thead",createNode("tr",weekdaysCollection.map(function(weekday){return createNode("th",weekday,CLASSES.weekdays)})))}((SETTINGS.showWeekdaysShort?SETTINGS.weekdaysShort:SETTINGS.weekdaysFull).slice(0)),$HOLDER=$(createNode(STRING_DIV,createCalendarWrapped(),CLASSES.holder)).on("mousedown",function(event){if(getCalendarItems().indexOf(event.target)<0){event.preventDefault()}}).on("click",function(event){var dateToSelect,$target=$(event.target),targetData=$target.data();event.stopPropagation();ELEMENT.focus();CALENDAR._IE=1;if(targetData.nav){showMonth(MONTH_FOCUSED.MONTH+targetData.nav)}else if(targetData.clear){P.clear().close()}else if(targetData.date){dateToSelect=targetData.date.split("/");P.setDate(+dateToSelect[0],+dateToSelect[1],+dateToSelect[2]).close()}else if($target[0]==$HOLDER[0]){P.close()}}),KEYCODE_TO_DATE={40:7,38:-7,39:1,37:-1};function createBoundaryDate(limit,upper){if(limit===true){return DATE_TODAY}if(Array.isArray(limit)){--limit[1];return createDate(limit)}if(limit&&!isNaN(limit)){return createDate([DATE_TODAY.YEAR,DATE_TODAY.MONTH,DATE_TODAY.DATE+limit])}return createDate(0,upper?Infinity:-Infinity)}function createValidatedDate(datePassed,direction){datePassed=!datePassed.TIME?createDate(datePassed):datePassed;if(DATES_TO_DISABLE){var originalDate=datePassed;while(DATES_TO_DISABLE.filter(DISABLED_DATES,datePassed).length){datePassed=createDate([datePassed.YEAR,datePassed.MONTH,datePassed.DATE+(direction||1)]);if(datePassed.MONTH!=originalDate.MONTH){datePassed=createDate([originalDate.YEAR,originalDate.MONTH,direction>0?++originalDate.DATE:--originalDate.DATE]);originalDate=datePassed}}}if(datePassed.TIME<DATE_MIN.TIME){datePassed=createValidatedDate(DATE_MIN)}else if(datePassed.TIME>DATE_MAX.TIME){datePassed=createValidatedDate(DATE_MAX,-1)}return datePassed}function createMonthNav(next){if(next&&MONTH_FOCUSED.YEAR>=DATE_MAX.YEAR&&MONTH_FOCUSED.MONTH>=DATE_MAX.MONTH||!next&&MONTH_FOCUSED.YEAR<=DATE_MIN.YEAR&&MONTH_FOCUSED.MONTH<=DATE_MIN.MONTH){return""}var monthTag="month"+(next?"Next":"Prev");return createNode(STRING_DIV,SETTINGS[monthTag],CLASSES[monthTag],"data-nav="+(next||-1))}function createMonthLabel(monthsCollection){return SETTINGS.monthSelector?createNode("select",monthsCollection.map(function(month,monthIndex){return createNode("option",month,0,"value="+monthIndex+(MONTH_FOCUSED.MONTH==monthIndex?" selected":"")+getMonthInRange(monthIndex,MONTH_FOCUSED.YEAR," disabled",""))}),CLASSES.selectMonth,getTabindexState()):createNode(STRING_DIV,monthsCollection[MONTH_FOCUSED.MONTH],CLASSES.month)}function createYearLabel(){var yearFocused=MONTH_FOCUSED.YEAR,yearsInSelector=SETTINGS.yearSelector;if(yearsInSelector){yearsInSelector=yearsInSelector===true?5:~~(yearsInSelector/2);var yearsCollection=[],lowestYear=yearFocused-yearsInSelector,firstYear=getNumberInRange(lowestYear,DATE_MIN.YEAR),highestYear=yearFocused+yearsInSelector+(firstYear-lowestYear),lastYear=getNumberInRange(highestYear,DATE_MAX.YEAR,1);firstYear=getNumberInRange(lowestYear-(highestYear-lastYear),DATE_MIN.YEAR);for(var index=0;index<=lastYear-firstYear;index+=1){yearsCollection.push(firstYear+index)}return createNode("select",yearsCollection.map(function(year){return createNode("option",year,0,"value="+year+(yearFocused==year?" selected":""))}),CLASSES.selectYear,getTabindexState())}return createNode(STRING_DIV,yearFocused,CLASSES.year)}function createTableBody(){var loopDate,pseudoIndex,classAndBinding,calendarDates=[],calendarWeeks="",countMonthDays=createDate([MONTH_FOCUSED.YEAR,MONTH_FOCUSED.MONTH+1,0]).DATE,countShiftby=createDate([MONTH_FOCUSED.YEAR,MONTH_FOCUSED.MONTH,1]).DAY+(SETTINGS.firstDay?-2:-1),createDateClassAndBinding=function(loopDate,isMonthFocused){var isDateDisabled,klassCollection=[CLASSES.day,isMonthFocused?CLASSES.dayInfocus:CLASSES.dayOutfocus];if(loopDate.TIME<DATE_MIN.TIME||loopDate.TIME>DATE_MAX.TIME||DATES_TO_DISABLE&&DATES_TO_DISABLE.filter(DISABLED_DATES,loopDate).length){isDateDisabled=1;klassCollection.push(CLASSES.dayDisabled)}if(loopDate.TIME==DATE_TODAY.TIME){klassCollection.push(CLASSES.dayToday)}if(loopDate.TIME==DATE_HIGHLIGHTED.TIME){klassCollection.push(CLASSES.dayHighlighted)}if(loopDate.TIME==DATE_SELECTED.TIME){klassCollection.push(CLASSES.daySelected)}return[klassCollection.join(" "),"data-"+(isDateDisabled?"disabled":"date")+"="+[loopDate.YEAR,loopDate.MONTH+1,loopDate.DATE].join("/")]};countShiftby+=countShiftby<-1?7:0;for(var index=0;index<DAYS_IN_CALENDAR;index+=1){pseudoIndex=index-countShiftby;loopDate=createDate([MONTH_FOCUSED.YEAR,MONTH_FOCUSED.MONTH,pseudoIndex]);classAndBinding=createDateClassAndBinding(loopDate,pseudoIndex>0&&pseudoIndex<=countMonthDays);calendarDates.push(createNode("td",createNode(STRING_DIV,loopDate.DATE,classAndBinding[0],classAndBinding[1])));if(index%DAYS_IN_WEEK+1==DAYS_IN_WEEK){calendarWeeks+=createNode("tr",calendarDates.splice(0,DAYS_IN_WEEK))}}return createNode("tbody",calendarWeeks,CLASSES.body)}function createTodayAndClear(){return createNode("button",SETTINGS.today,CLASSES.buttonToday,"data-date="+getDateFormatted("yyyy/mm/dd",DATE_TODAY)+" "+getTabindexState())+createNode("button",SETTINGS.clear,CLASSES.buttonClear,"data-clear=1 "+getTabindexState())}function createCalendarWrapped(){return createNode(STRING_DIV,createNode(STRING_DIV,createNode(STRING_DIV,createNode(STRING_DIV,createMonthNav()+createMonthNav(1)+createMonthLabel(SETTINGS.showMonthsFull?SETTINGS.monthsFull:SETTINGS.monthsShort)+createYearLabel(),CLASSES.header)+createNode("table",[TABLE_HEAD,createTableBody()],CLASSES.table)+createNode(STRING_DIV,createTodayAndClear(),CLASSES.footer),CLASSES.calendar),CLASSES.wrap),CLASSES.frame)}function getNumberInRange(number,limit,upper){return upper&&number<limit||!upper&&number>limit?number:limit}function getMonthInRange(month,year,alternateValue,inRangeValue){if(year<=DATE_MIN.YEAR&&month<DATE_MIN.MONTH){return alternateValue||DATE_MIN.MONTH}if(year>=DATE_MAX.YEAR&&month>DATE_MAX.MONTH){return alternateValue||DATE_MAX.MONTH}return inRangeValue!=null?inRangeValue:month}function getTabindexState(){return"tabindex="+(CALENDAR.isOpen?0:-1)}function getDateFormatted(format,date){return DATE_FORMATS.toArray(format||SETTINGS.format).map(function(value){return triggerFunction(DATE_FORMATS[value],date||DATE_SELECTED)||value}).join("")}function setDateSelected(dateTargeted,isSuperficial){DATE_HIGHLIGHTED=dateTargeted;MONTH_FOCUSED=dateTargeted;if(!isSuperficial){setElementsValue(dateTargeted)}calendarRender()}function setElementsValue(dateTargeted){DATE_SELECTED=dateTargeted||DATE_SELECTED;$ELEMENT.val(dateTargeted?getDateFormatted():"").trigger("change");if(ELEMENT_HIDDEN){ELEMENT_HIDDEN.value=dateTargeted?getDateFormatted(SETTINGS.formatSubmit):""}triggerFunction(SETTINGS.onSelect,P)}function $findInHolder(klass){return $HOLDER.find("."+klass)}function showMonth(month,year){year=year||MONTH_FOCUSED.YEAR;month=getMonthInRange(month,year);MONTH_FOCUSED=createDate([year,month,1]);calendarRender()}function toggleCalendarElements(tabindex){getCalendarItems().map(function(item){if(item)item.tabIndex=tabindex})}function getCalendarItems(){return[CALENDAR.selectMonth,CALENDAR.selectYear,$findInHolder(CLASSES.buttonToday)[0],$findInHolder(CLASSES.buttonClear)[0]]}function calendarRender(){$HOLDER.html(createCalendarWrapped());postRender()}function postRender(){CALENDAR.selectMonth=$findInHolder(CLASSES.selectMonth).on({click:function(event){event.stopPropagation()},change:function(){showMonth(+this.value);$findInHolder(CLASSES.selectMonth).focus()}})[0];CALENDAR.selectYear=$findInHolder(CLASSES.selectYear).on({click:function(event){event.stopPropagation()},change:function(){showMonth(MONTH_FOCUSED.MONTH,+this.value);$findInHolder(CLASSES.selectYear).focus()}})[0]}return new P.init};function triggerFunction(callback,scope){if(typeof callback=="function"){return callback.call(scope)}}function leadZero(number){return(number<10?"0":"")+number}function createNode(wrapper,item,klass,attribute){if(!item)return"";item=Array.isArray(item)?item.join(""):item;klass=klass?' class="'+klass+'"':"";attribute=attribute?" "+attribute:"";return"<"+wrapper+klass+attribute+">"+item+"</"+wrapper+">"}function createDate(datePassed,unlimited){if(Array.isArray(datePassed)){datePassed=new Date(datePassed[0],datePassed[1],datePassed[2])}else if(!isNaN(datePassed)){datePassed=new Date(datePassed)}else if(!unlimited){datePassed=new Date;datePassed.setHours(0,0,0,0)}return{YEAR:unlimited||datePassed.getFullYear(),MONTH:unlimited||datePassed.getMonth(),DATE:unlimited||datePassed.getDate(),DAY:unlimited||datePassed.getDay(),TIME:unlimited||datePassed.getTime(),OBJ:unlimited||datePassed}}$.fn.pickadate=function(options){var pickadate="pickadate";options=$.extend(true,{},$.fn.pickadate.defaults,options);if(options.disablePicker){return this}return this.each(function(){var $this=$(this);if(this.nodeName=="INPUT"&&!$this.data(pickadate)){$this.data(pickadate,new Picker($this,options))}})};$.fn.pickadate.defaults={monthsFull:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdaysFull:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],monthPrev:"&#9664;",monthNext:"&#9654;",showMonthsFull:1,showWeekdaysShort:1,today:"Today",clear:"Clear",format:"d mmmm, yyyy",formatSubmit:0,hiddenSuffix:"_submit",firstDay:0,monthSelector:0,yearSelector:0,dateMin:0,dateMax:0,datesDisabled:0,disablePicker:0,onOpen:0,onClose:0,onSelect:0,onStart:0,klass:{bodyActive:STRING_PREFIX_DATEPICKER+"active",inputActive:STRING_PREFIX_DATEPICKER+"input--active",holder:STRING_PREFIX_DATEPICKER+"holder",opened:STRING_PREFIX_DATEPICKER+"holder--opened",focused:STRING_PREFIX_DATEPICKER+"holder--focused",frame:STRING_PREFIX_DATEPICKER+"frame",wrap:STRING_PREFIX_DATEPICKER+"wrap",calendar:STRING_PREFIX_DATEPICKER+"calendar",table:STRING_PREFIX_DATEPICKER+"table",header:STRING_PREFIX_DATEPICKER+"header",monthPrev:STRING_PREFIX_DATEPICKER+"nav--prev",monthNext:STRING_PREFIX_DATEPICKER+"nav--next",month:STRING_PREFIX_DATEPICKER+"month",year:STRING_PREFIX_DATEPICKER+"year",selectMonth:STRING_PREFIX_DATEPICKER+"select--month",selectYear:STRING_PREFIX_DATEPICKER+"select--year",weekdays:STRING_PREFIX_DATEPICKER+"weekday",body:STRING_PREFIX_DATEPICKER+"body",day:STRING_PREFIX_DATEPICKER+"day",dayDisabled:STRING_PREFIX_DATEPICKER+"day--disabled",daySelected:STRING_PREFIX_DATEPICKER+"day--selected",dayHighlighted:STRING_PREFIX_DATEPICKER+"day--highlighted",dayToday:STRING_PREFIX_DATEPICKER+"day--today",dayInfocus:STRING_PREFIX_DATEPICKER+"day--infocus",dayOutfocus:STRING_PREFIX_DATEPICKER+"day--outfocus",footer:STRING_PREFIX_DATEPICKER+"footer",buttonClear:STRING_PREFIX_DATEPICKER+"button--clear",buttonToday:STRING_PREFIX_DATEPICKER+"button--today"}}})(jQuery,document);define("jam/pickadate/source/pickadate",function(){});define("js/patterns/datetime",["jquery","js/patterns/base","jam/pickadate/source/pickadate"],function($,Base){var DateTime=Base.extend({name:"datetime",defaults:{format:"d-mmmm-yyyy@HH:MM",formatsubmit:"yyyy-m-d H:M",ampm:"AM,PM",minutestep:"5",klass:{wrapper:"pat-datetime-wrapper",icon:"pat-datetime-icon",year:"pat-datetime-year",month:"pat-datetime-month",day:"pat-datetime-day",hour:"pat-datetime-hour",minute:"pat-datetime-minute",ampm:"pat-datetime-ampm",delimiter:"pat-datetime-delimiter"},pickadate:{monthSelector:true,yearSelector:true}},init:function(){var self=this;if(!self.$el.is("input")){return}self.pickadateOptions=$.extend(true,{},$.fn.pickadate.defaults,{formatSubmit:"yyyy-mm-dd",onSelect:function(e){var date=this.getDate("yyyy-mm-dd").split("-");self.$years.val(parseInt(date[0],10));self.$months.val(parseInt(date[1],10));self.$days.val(parseInt(date[2],10));self.setDate(self.$years.val(),self.$months.val(),self.$days.val(),self.$hours.val(),self.$minutes.val(),self.$ampm.val())}},self.options.pickadate);self.$el.hide();self.$wrapper=$("<div/>").addClass(self.options.klass.wrapper).insertAfter(self.$el);self.pickadate=$("<input/>").hide().appendTo(self.$wrapper).pickadate(self.pickadateOptions).data("pickadate");function changePickadateDate(){if(self.$years.val()!==""&&self.$months.val()!==""&&self.$days.val()!==""){self.pickadate.setDate(parseInt(self.$years.val(),10),parseInt(self.$months.val(),10),parseInt(self.$days.val(),10),true)}self.setDate(self.$years.val(),self.$months.val(),self.$days.val(),self.$hours.val(),self.$minutes.val(),self.$ampm.val())}self.$years=$("<select/>").addClass(self.options.klass.year).on("change",changePickadateDate);self.$months=$("<select/>").addClass(self.options.klass.month).on("change",changePickadateDate);self.$days=$("<select/>").addClass(self.options.klass.day).on("change",changePickadateDate);self.$hours=$("<select/>").addClass(self.options.klass.hour).on("change",changePickadateDate);self.$minutes=$("<select/>").addClass(self.options.klass.minute).on("change",changePickadateDate);self.$icon=$('<span class="'+self.options.klass.icon+'"/>').on("click",function(e){e.stopPropagation();e.preventDefault();self.toggle()});$.each(self._strftime(self.options.format,function(format){switch(format){case"yy":case"yyyy":return self.$years.append(self._getYears(format));case"m":case"mm":case"mmm":case"mmmm":return self.$months.append(self._getMonths(format));case"d":case"dd":case"ddd":case"dddd":return self.$days.append(self._getDays(format));case"H":case"HH":return self.$hours.append(self._getHours(format));case"M":case"MM":return self.$minutes.append(self._getMinutes(format));case"@":return self.$icon;default:return $("<span> "+format+" </span>").addClass(self.options.klass.delimiter)}}),function(i,$item){self.$wrapper.append($item)});if(self.options.ampm){self.$ampm=$("<select/>").addClass(self.options.klass.ampm).append(self._getAMPM()).on("change",changePickadateDate);self.$wrapper.append($("<span> </span>"));self.$wrapper.append(self.$ampm)}if(self.$el.val()!==""){var tmp=self.$el.val().split(" "),date=tmp[0].split("-"),time=tmp[1].split(":"),ampm=parseInt(time[0],10)>=12&&"PM"||"AM";time[0]-=parseInt(time[0],10)>=12&&12||0;self.setDate(date[0],date[1],date[2],time[0],time[1],ampm);self.$years.val(""+parseInt(date[0],10));self.$months.val(""+parseInt(date[1],10));self.$days.val(""+parseInt(date[2],10));self.$hours.val(""+parseInt(time[0],10));self.$minutes.val(""+parseInt(time[1],10));if(self.options.ampm){self.$ampm.val(ampm)}}},_strftime:function(format,action,options){var self=this,result=[];options=options||["dddd","ddd","dd","d","mmmm","mmm","mm","m","yyyy","yy","HH","H","MM","M","@"];$.each(options,function(i,itemFormat){if(format.indexOf(itemFormat)!==-1){var temp=format.split(itemFormat),new_result;if(options.length>0&&temp[0]!==""){new_result=result.concat(self._strftime(temp[0],action,options.slice(i)));if(new_result.length===result.length){result.push(action(temp[0]))}else{result=new_result}}result.push(action(itemFormat));if(options.length>0&&temp[1]!==""){new_result=result.concat(self._strftime(temp[1],action,options.slice(i)));if(new_result.length===result.length){result.push(action(temp[1]))}else{result=new_result}}return false}if(options.length===0){return false}});return result},_getYears:function(format){var years=[],current=this.getDate("yyyy"),_current=current,min,max;if(!current){current=(new Date).getFullYear();min=current-10;max=current+10}else{min=this.pickadate.getdatelimit("yyyy"),max=this.pickadate.getDateLimit(true,"yyyy")}years.push(this._createOption("","--",_current===undefined));while(min<=max){if(format==="yy"){years.push(this._createOption(min,(""+min).slice(-2),min===_current))}else{years.push(this._createOption(min,min,min===_current))}min+=1}return years},_getMonths:function(format){var months=[],current=this.getDate("m"),month=1;months.push(this._createOption("","--",current===undefined));while(month<=12){if(format==="m"){months.push(this._createOption(month,month,current===month))}else if(format==="mm"){months.push(this._createOption(month,("0"+month).slice(-2),current===month))}else if(format==="mmm"){months.push(this._createOption(month,this.pickadateOptions.monthsShort[month-1],current===month))}else{months.push(this._createOption(month,this.pickadateOptions.monthsFull[month-1],current===month))}month+=1}return months},_getDays:function(format){var days=[],current=this.getDate("d"),currentMonth=this.getDate("m"),maxDays=31,day=1;days.push(this._createOption("","--",current===undefined));if(currentMonth){if($.inArray(currentMonth,[4,6,9,11])){maxDays=30}else if($.inArray(currentMonth,[2])){maxDays=29}}while(day<=maxDays){if(format==="d"){days.push(this._createOption(day,day,current===day))}else{days.push(this._createOption(day,("0"+day).slice(-2),current===day))}day+=1}return days},_getAMPM:function(){var AMPM=this.options.ampm.split(",");return[this._createOption(AMPM[0],AMPM[0]),this._createOption(AMPM[1],AMPM[1])]},_getHours:function(format){var hours=[],current=this.getDate("h"),hour=0;hours.push(this._createOption("","--",current===undefined));while(hour<(this.options.ampm&&12||24)){if(format==="H"){hours.push(this._createOption(hour,hour,current===hour))}else{hours.push(this._createOption(hour,("0"+hour).slice(-2),current===hour))}hour+=1}return hours},_getMinutes:function(format){var minutes=[],current=this.getDate("m"),minute=0;minutes.push(this._createOption("","--",current===undefined));while(minute<60){if(format==="M"){minutes.push(this._createOption(minute,minute,current===minute))}else{minutes.push(this._createOption(minute,("0"+minute).slice(-2),current===minute))}minute+=parseInt(this.options.minutestep,10)}return minutes},_createOption:function(token,title,selected){var $el=$("<option/>").attr("value",token).html(title);if(selected){$el.attr("selected","selected")}return $el},setDate:function(year,month,day,hour,minutes,ampm){var self=this;self._rawDate=undefined;self.$el.attr("value","");if(year!==""&&month!==""&&day!==""&&hour!==""&&minutes!==""){self._rawDate=new Date(parseInt(year,10),parseInt(month,10),parseInt(day,10),parseInt(hour,10)+(ampm==="PM"&&12||0),parseInt(minutes,10));self.$el.attr("value",self.getDate(self.options.formatsubmit))}},getDate:function(format){var self=this;if(!self._rawDate){return}if(format){return self._strftime(format,function(format){switch(format){case"yy":return(""+self._rawDate.getFullYear()).slice(-2);case"yyyy":return""+self._rawDate.getFullYear();case"m":return""+self._rawDate.getMonth();case"mm":return("0"+self._rawDate.getMonth()).slice(-2);case"mmm":return self.pickadateOptions.monthsShort[self._rawDate.getMonth()];case"mmmm":return self.pickadateOptions.monthsFull[self._rawDate.getMonth()];case"d":return""+self._rawDate.getDate();case"dd":return("0"+self._rawDate.getDate()).slice(-2);case"ddd":return self.pickadateOptions.weekdaysShort[self._rawDate.getDay()];case"dddd":return self.pickadateOptions.weekdaysFull[self._rawDate.getDay()];case"H":return""+self._rawDate.getHours();case"HH":return("0"+self._rawDate.getHours()).slice(-2);case"M":return""+self._rawDate.getMinutes();case"MM":return("0"+self._rawDate.getMinutes()).slice(-2);default:return format}}).join("")}return self._rawDate},toggle:function(){if(this._opened){this.close()}else{this.open()}},open:function(){if(!this._opened){this.trigger("open");this.pickadate.open();this._opened=true;this.trigger("opened")}},close:function(){if(this._opened){this.trigger("close");this.pickadate.close();this._opened=false;this.trigger("closed")}}});return DateTime});define("js/patterns/autotoc",["jquery","js/patterns/base"],function($,Base,Parser){var AutoTOC=Base.extend({name:"autotoc",defaults:{section:"section",levels:"h1,h2,h3",IDPrefix:"autotoc-item-",klassTOC:"autotoc-nav",klassSection:"autotoc-section",klassLevelPrefix:"autotoc-level-",klassActive:"active",scrollDuration:"slow",scrollEasing:"swing"},init:function(){var self=this;self.$toc=$("<nav/>").prependTo(self.$el).addClass(self.options.klassTOC);if(self.options.klass){self.$el.addClass(self.options.klass)}$(self.options.section,self.$el).addClass(self.options.klassSection);$(self.options.levels,self.$el).each(function(i){var $level=$(this),id=$level.prop("id")?"#"+$level.prop("id"):$level.parents(self.options.section).prop("id");if(!id){id=self.options.IDPrefix+self.name+"-"+i;$level.prop("id",id)}$("<a/>").appendTo(self.$toc).text($level.text()).prop("href",id).addClass(self.options.klassLevelPrefix+self.getLevel($level)).on("click",function(e,doScroll){e.stopPropagation();e.preventDefault();$("."+self.options.klassActive,self.$el).removeClass(self.options.klassActive);$(e.target).addClass(self.options.klassActive);$level.parents(self.options.section).addClass(self.options.klassActive);if(doScroll!==false&&self.options.scrollDuration&&$level){$("body,html").animate({scrollTop:$level.offset().top},self.options.scrollDuration,self.options.scrollEasing)}if(self.$el.parents(".modal").size()!==0){self.$el.trigger("resize.modal.patterns")}})});self.$toc.find("a").first().trigger("click",false)},getLevel:function($el){var elementLevel=0;$.each(this.options.levels.split(","),function(level,levelSelector){if($el.filter(levelSelector).size()===1){elementLevel=level+1;return false}});return elementLevel}});return AutoTOC});if(window.jQuery){define("jquery",[],function(){return window.jQuery})}define("js/bundles/widgets",["jquery","jam/Patterns/src/registry","logging","js/patterns/select2","js/patterns/datetime","js/patterns/autotoc"],function($,registry){var Widgets={name:"plone-widgets",transform:function($root){var $match=$root.filter(".enableFormTabbing");$match=$match.add($root.find(".enableFormTabbing"));$match.addClass("pat-autotoc");$match.attr({"data-autotoc-levels":"legend","data-autotoc-section":"fieldset","data-autotoc-klass":"autotabs"})}};registry.register(Widgets);return Widgets});define("js/bundles/toolbar",["jquery","js/jquery.iframe","jam/Patterns/src/registry","js/patterns/base","js/patterns/backdrop","jam/jquery-form/jquery.form.js","js/patterns/toggle","js/patterns/modal.js","js/bundles/widgets"],function($,iframe,registry,Base,Backdrop){window.plone=window.plone||{};window.plone.toolbar=window.plone.toolbar||{};$(document).ready(function(){var TinyMCE=Base.extend({name:"plone-tinymce",jqueryPlugin:"ploneTinymce",init:function(){window.initTinyMCE(this.$el.parent())}});$(".toolbar-dropdown > a").toggle({target:".toolbar-dropdown",value:"toolbar-dropdown-open"});$(document).on("add-attr.toggle.patterns",".toolbar-dropdown > a",function(e){var $el=$(this);$(".toolbar-dropdown-open > a").each(function(){if($el[0]!==$(this)[0]){$(this).trigger("click")}});iframe.stretch()}).on("removed-attr.toggle.patterns",".toolbar-dropdown > a",function(e){iframe.shrink()});iframe.$el.on("shrink.iframe",function(e){$(".toolbar-dropdown-open > a").each(function(){$(this).trigger("click")})});$(document).on("before-ajax.modal.patterns","a.modal-trigger",function(e){var $el=$(this);$(".toolbar-dropdown-open > a").each(function(){if($el[0]!==$(this)[0]){$(this).trigger("click")}});$("body",iframe.document).css("overflow","hidden");iframe.stretch()}).on("show.modal.patterns","a.modal-trigger",function(e,modal){var $el=$(this);$(".toolbar-dropdown-open > a").each(function(){if($el[0]!==$(this)[0]){$(this).trigger("click")}});$("body",iframe.document).css("overflow","hidden");iframe.stretch()}).on("hidden.modal.patterns","a.modal-trigger",function(e){$("body",iframe.document).css("overflow","visible");iframe.shrink()});function modalTemplate($modal,options){var $content=$modal.html();options=$.extend({title:"h1.documentFirstHeading",buttons:'.formControls > input[type="submit"]',content:"#content"},options||{});$modal.html('<div class="modal-header">'+'  <a class="close">&times;</a>'+"  <h3></h3>"+"</div>"+'<div class="modal-body"></div>'+'<div class="modal-footer"></div>');$(".modal-header > h3",$modal).html($(options.title,$content).html());$(".modal-body",$modal).html($(options.content,$content).html());$(options.title,$modal).remove();$(".modal-header > a.close",$modal).off("click").on("click",function(e){e.stopPropagation();e.preventDefault();$(e.target).trigger("destroy.modal.patterns")});$(".row",$modal).removeClass("row");$(options.buttons,$modal).each(function(){var $button=$(this);$button.on("click",function(e){e.stopPropagation();e.preventDefault()}).clone().appendTo($(".modal-footer",$modal)).off("click").on("click",function(e){e.stopPropagation();e.preventDefault();$button.trigger("click")});$button.hide()})}function modalAjaxForm(modal,modalInit,options){options=$.extend({buttons:{},timeout:5e3,formError:".portalMessage.error"},options);$.each(options.buttons,function(buttons,buttonsOptions){buttonsOptions=$.extend({},options,buttonsOptions);$(buttons,modal.$modal).each(function(button){var $button=$(this);var extraData={};extraData[$button.attr("name")]=$button.attr("value");$button.on("click",function(e){e.stopPropagation();e.preventDefault();var backdrop=modal.$modal.data("patterns-backdrop");if(!backdrop){backdrop=new Backdrop(modal.$modal,{closeOnEsc:false,closeOnClick:false});backdrop.$backdrop.html("").append($(""+'<div class="progress progress-striped active">'+'  <div class="bar" style="width: 100%;"></div>'+"</div>").css({position:"absolute",left:modal.$modal.width()*.1,top:modal.$modal.height()/2+10,width:modal.$modal.width()*.8}));modal.$modal.data("patterns-backdrop",backdrop)}else{modal.$modal.append(backdrop.$backdrop)}backdrop.show();if($.nodeName($button[0],"input")){$button.parents("form").ajaxSubmit({timeout:buttonsOptions.timeout,dataType:"html",data:extraData,url:$button.parents("form").attr("action"),error:function(xhr,textStatus,errorStatus){if(textStatus==="timeout"&&buttonsOptions.onTimeout){buttonsOptions.onTimeout(modal,xhr,errorStatus)}else if(buttonsOptions.onError){buttonsOptions.onError(xhr,textStatus,errorStatus)}else{console.log("error happened do something")}},success:function(response,state,xhr,form){var responseBody=$(/<body[^>]*>((.|[\n\r])*)<\/body>/im.exec(response)[0].replace("<body","<div").replace("</body>","</div>"));if($(buttonsOptions.formError,responseBody).size()!==0){if(buttonsOptions.onFormError){buttonsOptions.onFormError(modal,responseBody,state,xhr,form)}else{modal.$modal.html(responseBody.html());modalInit(modal,modalInit);modal.positionModal();registry.scan(modal.$modal)}}else if(buttonsOptions.onSuccess){buttonsOptions.onSuccess(modal,responseBody,state,xhr,form)
}else{$button.trigger("destroy.modal.patterns")}}})}else if($.nodeName($button[0],"a")){$.ajax({url:$button.attr("href"),error:function(xhr,textStatus,errorStatus){if(textStatus==="timeout"&&buttonsOptions.onTimeout){buttonsOptions.onTimeout(modal,xhr,errorStatus)}else if(buttonsOptions.onError){buttonsOptions.onError(xhr,textStatus,errorStatus)}else{console.log("error happened do something")}},success:function(response,state,xhr){var responseBody=$(/<body[^>]*>((.|[\n\r])*)<\/body>/im.exec(response)[0].replace("<body","<div").replace("</body>","</div>"));if($(buttonsOptions.formError,responseBody).size()!==0){if(buttonsOptions.onFormError){buttonsOptions.onFormError(modal,responseBody,state,xhr)}else{modal.$modal.html(responseBody.html());modalInit(modal,modalInit);modal.positionModal();registry.scan(modal.$modal)}}else if(buttonsOptions.onSuccess){buttonsOptions.onSuccess(modal,responseBody,state,xhr)}else{$button.trigger("destroy.modal.patterns")}}})}})})})}function modalInit(selector,callback,modalOptions){$(selector).addClass("modal-trigger").modal(modalOptions);$(document).on("show.modal.patterns",selector+".modal-trigger",function(e,modal){callback(modal,callback)})}modalInit("#plone-action-folderContents > a",function(modal,modalInit){modalTemplate(modal.$modal,{buttons:"#folderlisting-main-table > input.context,#folderlisting-main-table > input.standalone,.modal-body .formControls > input"});$(".modal-footer input.context",modal.$modal).removeClass("context").addClass("standalone");function refreshModal(modal,responseBody,state,xhr,form){modal.$modal.html(responseBody.html());modalInit(modal,modalInit);modal.positionModal();registry.scan(modal.$modal)}$(".modal-body #folderlisting-main-table td:not(.draggable) > a:not(.contenttype-folder)",modal.$modal).css({color:"#333333"}).on("click",function(e){window.parent.location.href=$(this).attr("href")});modalAjaxForm(modal,modalInit,{buttons:{".modal-body #folderlisting-main-table > input.standalone":{onSuccess:refreshModal},".modal-body #folderlisting-main-table > input.context":{onSuccess:refreshModal},".modal-body .formControls > input.standalone":{onSuccess:refreshModal},".modal-body .formControls > input.context":{onSuccess:refreshModal},".modal-body a#foldercontents-selectall":{onSuccess:refreshModal},".modal-body a#foldercontents-clearselection":{onSuccess:refreshModal},".modal-body #folderlisting-main-table td:not(.draggable) > a.contenttype-folder":{onSuccess:refreshModal},".modal-body .link-parent":{onSuccess:refreshModal},".modal-body td.draggable > a":{onSuccess:refreshModal}}})});modalInit("#plone-action-edit > a",function(modal,modalInit){modalTemplate(modal.$modal,{buttons:'input[name="form.buttons.save"],input[name="form.buttons.cancel"]'});$("span.label",modal.$modal).removeClass("label");$(".mce_editable",modal.$modal).addClass("pat-plone-tinymce");modalAjaxForm(modal,modalInit,{buttons:{'.modal-body input[name="form.buttons.cancel"]':{},'.modal-body input[name="form.buttons.save"]':{onSuccess:function(modal,responseBody,state,xhr,form){$("#portal-column-content",window.parent.document).html($("#portal-column-content",responseBody).html());modal.hide()}}}})});modalInit("#plone-action-local_roles > a",function(modal,modalInit){modalTemplate(modal.$modal,{buttons:'input[name="form.button.Save"],input[name="form.button.Cancel"]'});$("#link-presentation",modal.$modal).remove();modalAjaxForm(modal,modalInit,{buttons:{'.modal-body input[name="form.button.Cancel"]':{},'.modal-body input[name="form.button.Save"]':{},'.modal-body input[name="form.button.Search"]':{onSuccess:function(modal,responseBody,state,xhr,form){modal.$modal.html(responseBody.html());modalInit(modal,modalInit);modal.positionModal();registry.scan(modal.$modal)}}}})});modalInit("#plone-action-contentrules > a",function(modal,modalInit){modalTemplate(modal.$modal,{buttons:'input[name="form.button.AddAssignment"],'+'input[name="form.button.Enable"],'+'input[name="form.button.Disable"],'+'input[name="form.button.Bubble"],'+'input[name="form.button.NoBubble"],'+'input[name="form.button.Delete"]'});$(".modal-body #content-core > p:first > a",modal.$modal).on("click",function(e){window.parent.location.href=$(this).attr("href")});modalAjaxForm(modal,modalInit,{buttons:{'input[name="form.button.AddAssignment"],input[name="form.button.Enable"],input[name="form.button.Disable"],input[name="form.button.Bubble"],input[name="form.button.NoBubble"],input[name="form.button.Delete"]':{onSuccess:function(modal,responseBody,state,xhr,form){modal.$modal.html(responseBody.html());modalInit(modal,modalInit);modal.positionModal();registry.scan(modal.$modal)}}}})});modalInit("#plone-contentmenu-actions-delete > a",function(modal,modalInit){modalTemplate(modal.$modal,{buttons:'input[name="form.button.Cancel"],input.destructive'});modalAjaxForm(modal,modalInit,{buttons:{'.modal-body input[name="form.button.Cancel"]':{},".modal-body input.destructive":{onSuccess:function(modal,responseBody,state,xhr,form){window.parent.location.href=$($(xhr.responseText).filter("base")[0]).attr("href")}}}})});modalInit("#plone-contentmenu-actions-rename > a",function(modal,modalInit){modalTemplate(modal.$modal,{buttons:'input[name="form.button.Cancel"],input[name="form.button.RenameAll"]'});modalAjaxForm(modal,modalInit,{buttons:{'.modal-body input[name="form.button.Cancel"]':{},'.modal-body input[name="form.button.RenameAll"]':{onSuccess:function(modal,responseBody,state,xhr,form){window.parent.location.href=$($(xhr.responseText).filter("base")[0]).attr("href")+"/"+$('input[name="new_ids:list"]',form).val()}}}})});var changeContentItemAsDefaultView=function(modal,modalInit){modalTemplate(modal.$modal);$("form > dl",modal.$modal).addClass("default-page-listing");$('input[name="form.button.Cancel"]',modal.$modal).attr("class","standalone");modalAjaxForm(modal,modalInit,{buttons:{'.modal-body input[name="form.button.Cancel"]':{},'.modal-body input[name="form.button.Save"]':{onSuccess:function(modal,responseBody,state,xhr){window.parent.location.href=window.parent.location.href}}}})};modalInit("#folderChangeDefaultPage > a",changeContentItemAsDefaultView);modalInit("#contextSetDefaultPage > a",changeContentItemAsDefaultView);modalInit("#plone-contentmenu-factories > ul > li > a",function(modal,modalInit){modalTemplate(modal.$modal,{buttons:'input[name="form.buttons.save"],input[name="form.buttons.cancel"]'});$("span.label",modal.$modal).removeClass("label");$(".mce_editable",modal.$modal).addClass("pat-plone-tinymce");modalAjaxForm(modal,modalInit,{buttons:{'.modal-body input[name="form.buttons.cancel"]':{},'.modal-body input[name="form.buttons.save"]':{onSuccess:function(modal,responseBody,state,xhr,form){$("#portal-column-content",window.parent.document).html($("#portal-column-content",responseBody).html());window.parent.location.href=$($(xhr.responseText).filter("base")[0]).attr("href")}}}})});modalInit("#plone-contentmenu-settings > a",function(modal,modalInit){modalTemplate(modal.$modal);var $details=$("#details",modal.$modal).removeAttr("style").removeAttr("id").first().parent();function show_submenu($modal){if($("#mode_enable",$modal).is(":checked")){$details.attr({id:"details",style:""})}else{$details.attr({id:"details",style:"display:none;"})}}function check_mode($modal,value){var $preferred=$("#"+value,$modal),$allowed=$("#"+value+"_allowed",$modal),$allowed_hidden=$("#"+value+"_allowed_hidden",$modal);if(!$preferred.is(":checked")){$allowed.attr("checked",false);$allowed.attr("disabled",true)}else{$allowed.attr("disabled",false)}}$('input[name="constrainTypesMode:int"]',modal.$modal).removeAttr("onclick").on("click",function(){show_submenu($(this).parents(".modal"))});$('input[name="currentPrefer:list"],input[name="currentAllow:list"]',modal.$modal).removeAttr("onclick").on("click",function(){check_mode($(this).parents(".modal"),$(this).attr("id"))});show_submenu(modal.$modal);modalAjaxForm(modal,modalInit,{buttons:{'.modal-body input[name="form.button.Cancel"]':{},'.modal-body input[name="form.button.Save"]':{onSuccess:function(modal,responseBody,state,xhr){$("#plone-contentmenu-factories").html($("#plone-contentmenu-factories",responseBody).html());modal.hide()}}}})});modalInit("#workflow-transition-advanced > a",function(modal,modalInit){modalTemplate(modal.$modal,{buttons:'input[name="form.button.Cancel"],input[name="form.button.FolderPublish"],input[name="form.button.Publish"]'});$("#workflow_action",modal.$modal).parent().find("> br").remove();modalAjaxForm(modal,modalInit,{buttons:{'.modal-body input[name="form.button.Cancel"]':{},'.modal-body input[name="form.button.Publish"], .modal-body input[name="form.button.FolderPublish"]':{onSuccess:function(modal,responseBody,state,xhr){$("#plone-contentmenu-workflow").html($("#plone-contentmenu-workflow",responseBody).html());$("#plone-contentmenu-workflow > a").toggle({target:".toolbar-dropdown",value:"toolbar-dropdown-open"});$("#plone-contentmenu-workflow #workflow-transition-advanced > a").addClass("modal-trigger").modal();$("body",iframe.document).css("overflow","visible");modal.hide()}}}})});modalInit("#plone-personal-actions-preferences > a",function(modal,modalInit){modalTemplate(modal.$modal,{buttons:'input[name="form.actions.save"],input[name="form.actions.cancel"]'});$('select[name="form.wysiwyg_editor"], select[name="form.language"]',modal.$modal).addClass("pat-select2");$('input[name="form.actions.cancel"]',modal.$modal).attr("class","standalone");modalAjaxForm(modal,modalInit,{buttons:{'.modal-body input[name="form.actions.cancel"]':{},'.modal-body input[name="form.actions.save"]':{}}})})})});require(["js/bundles/toolbar"]);